import{Table}from"../scripts/table.js";import{GameStats,teamToObject}from"../scripts/stats.js";import fs from"fs";class PlayerInstance{constructor(e){this.name=e.name,this.attributes={power:e.power,speed:e.speed,eye:e.eye,block:e.block,breakblock:e.breakblock,tackle:e.breaktackle,breaktackle:e.breaktackle,awareness:e.awareness},this.position={x:0,y:0,z:15},this.role=null,this.objective=null,this.target=null,this.path=null,this.isOffense=!1,this.isRunner=!1,this.isReceiver=!1,this.isForced=!1,this.wasBallcarrier=!1,this.hasCaught=!1,this.hasPitched=!1,this.hasBatted=!1,this.onBase=null,this.assistor=!1,this.hitter=!1,this.pointsScored=0,this.assists=0,this.assistpoints=0,this.hits=0,this.hitstoout=0,this.hitstooffense=0,this.ballsfieldeddef=0,this.ballsfieldedoff=0,this.totaloutsrecorded=0,this.atbats=0,this.slams=0,this.slamsgiven=0,this.strikes=0,this.strikeoutspitching=0,this.balls=0,this.ballouts=0,this.fouls=0,this.pitches=0,this.strikeoutsbatting=0,this.foulouts=0,this.tackles=0,this.brokentackles=0,this.blocks=0,this.blocksshed=0,this.interceptions=0,this.turnovers=0}}class NewGameState{constructor(){this.offensename=null,this.defensename=null,this.score=0,this.phase=0,this.frame=0,this.onfirst={current:null,previous:null},this.onsecond={current:null,previous:null},this.onthird={current:null,previous:null},this.runners=[],this.outs=0,this.balls=0,this.strikes=0,this.fouls=0,this.catchercount=0,this.pitchercount=0,this.pitcherrot=!1,this.catcherrot=!1,this.batterrot=!1,this.ballpath=null,this.pitcher=null,this.catcher=null,this.batter=null,this.ballcarrier=null,this.offense=null,this.defense=null}update(e){let t=new NewGameState;return t.offensename=this.offensename,t.defensename=this.defensename,t.score=this.score+e.score,t.phase=e.phase,t.frame=this.frame,t.onfirst=e.onfirst,t.onsecond=e.onsecond,t.onthird=e.onthird,t.runners=e.runners,t.outs=this.outs+e.outs,t.balls=this.balls+e.balls,t.strikes=this.strikes+e.strikes,t.fouls=this.fouls+e.fouls,t.catchercount=this.catchercount+e.catchercount,t.pitchercount=this.pitchercount+e.pitchercount,t.pitcherrot=e.pitcherrot,t.catcherrot=e.catcherrot,t.batterrot=e.batterrot,t.ballpath=e.ballpath,t.pitcher=this.pitcher,t.catcher=this.catcher,t.batter=this.batter,t.ballcarrier=e.ballcarrier,t.offense=e.offense,t.defense=e.defense,t}resetPositions(){let e={onfirst:!1,onsecond:!1,onthird:!1};for(let t=0;t<this.offense.length;t++)1==this.offense[t].isRunner&&("first"==this.offense[t].onBase?(this.offense[t].position,e.onfirst=!0):"second"==this.offense[t].onBase?(this.offense[t].position=second,e.onsecond=!0):"third"==this.offense[t].onBase&&(this.offense[t].position=third,e.onthird=!0));let t=0,r=[],n=[];for(let e of this.offense)" "==e.role&&t++;if(t>0){r=1==e.onfirst?1==e.onsecond?1==e.onthird?["Pitcher","Third baseman"]:["Pitcher","Shortstop","Third baseman"]:1==e.onthird?["Pitcher","Shortstop","Third baseman"]:["Pitcher","First baseman","Second baseman","Shortstop"]:1==e.onsecond?1==e.onthird?["Pitcher","Shortstop","Third baseman"]:["Pitcher","Second baseman","Shortstop","Third baseman"]:1==e.onthird?["Pitcher","Second baseman","Shortstop","Third baseman"]:["Pitcher","First baseman","Second baseman","Shortstop","Third baseman"];let t=0;for(let e=0;e<r.length;e++){for(let n=0;n<this.offense.length;n++)if(this.offense[n].role==r[e]){t++;break}0===t?(n.push(r[e]),t=0):t=0}for(let e=0;e<n.length;e++)for(let t=0;t<this.offense.length;t++)if(" "==this.offense[t].role){this.offense[t].role=n[e];break}}for(let e=0;e<this.offense.length;e++)"Catcher"==this.offense[e].role?this.offense[e].position={x:-2,y:-2,z:15}:"Pitcher"==this.offense[e].role?this.offense[e].position={x:60,y:60,z:15}:"First baseman"==this.offense[e].role?this.offense[e].position={x:90,y:20,z:15}:"Second baseman"==this.offense[e].role?this.offense[e].position={x:90,y:60,z:15}:"Shortstop"==this.offense[e].role?this.offense[e].position={x:60,y:90,z:15}:"Third baseman"==this.offense[e].role&&(this.offense[e].position={x:20,y:90,z:15});for(let e=0;e<this.defense.length;e++)"Batter"==this.defense[e].role?this.defense[e].position={x:0,y:0,z:15}:"Infield Defender"==this.defense[e].role?this.defense[e].position={x:20,y:60,z:15}:"Right Fielder"==this.defense[e].role?this.defense[e].position={x:outfieldLineUp(this.defense[e]),y:20,z:15}:"Center-Right Fielder"==this.defense[e].role?this.defense[e].position={x:outfieldLineUp(this.defense[e]),y:60,z:15}:"Center-Left Fielder"==this.defense[e].role?this.defense[e].position={x:60,y:outfieldLineUp(this.defense[e]),z:15}:"Left Fielder"==this.defense[e].role&&(this.defense[e].position={x:20,y:outfieldLineUp(this.defense[e]),z:15})}resetObjectives(){for(let e=0;e<this.offense.length;e++)this.offense[e].objective=null,this.offense[e].path=null,this.offense[e].target=null,this.offense[e].wasBallcarrier=!1,this.offense[e].isForced=!1;for(let e=0;e<this.defense.length;e++)this.defense[e].objective=null,this.defense[e].path=null,this.defense[e].target=null}resetInning(){let e=this.offense,t=this.defense,r=this.offensename,n=this.defensename,l=0,s=0,a=0;for(let t=0;t<e.length;t++){if(0==e[5].hasCaught&&0==e[5].hasPitched)for(let t=0;t<e.length;t++)e[t].hasPitched=!1;0==e[t].hasCaught&&l++,0==e[t].hasPitched&&s++,e[t].onBase=null,e[t].role=null,e[t].objective=null,e[t].path=null,e[t].target=null,e[t].isOffense=!1,e[t].isRunner=!1,e[t].isReceiver=!1,e[t].isForced=!1,e[t].wasBallcarrier=!1}for(let e=0;e<t.length;e++)0==t[e].hasBatted&&a++,t[e].onBase=null,t[e].role=null,t[e].objective=null,t[e].path=null,t[e].target=null,t[e].isOffense=!0,t[e].isRunner=!1,t[e].isReceiver=!1,t[e].isForced=!1,t[e].wasBallcarrier=!1;if(0===l)for(let e=0;e<this.offense.length;e++)this.offense[e].hasCaught=!1;if(0===s)for(let e=0;e<this.offense.length;e++)this.offense[e].hasPitched=!1;if(0===a)for(let e=0;e<this.defense.length;e++)this.defense[e].hasBatted=!1;return this.pitcher=null,this.catcher=null,this.batter=null,this.onfirst.current=null,this.onfirst.previous=null,this.onsecond.current=null,this.onsecond.previous=null,this.onthird.current=null,this.onthird.previous=null,this.offense=t,this.defense=e,this.offensename=n,this.defensename=r,this.score=0,this.outs=0,this.strikes=0,this.balls=0,this.fouls=0,this.pitchercount=0,this.catchercount=0,this.catcherrot=!1,this.pitcherrot=!1,this.batterrot=!1,this.ballcarrier=null,this.phase=0,this.runners=[],this}}class NewResult{constructor(e){this.score=0,this.phase=e.phase,this.onfirst=e.onfirst,this.onsecond=e.onsecond,this.onthird=e.onthird,this.runners=e.runners,this.outs=0,this.balls=0,this.strikes=0,this.fouls=0,this.catchercount=0,this.pitchercount=0,this.ballcarrier=e.ballcarrier,this.pitcherrot=e.pitcherrot,this.catcherrot=e.catcherrot,this.batterrot=e.batterrot,this.ballpath=e.ballpath,this.defense=e.defense,this.offense=e.offense}}let first={x:90,y:0,z:15},second={x:90,y:90,z:15},third={x:0,y:90,z:15},home={x:0,y:0,z:15},frameglobal=0,offenseroles=[["Catcher",{x:-2,y:-2,z:15}],["Pitcher",{x:60,y:60,z:15}],["First baseman",{x:90,y:20,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],defenseroles=[["Batter",{x:0,y:0,z:15}],["Infield Defender",{x:20,y:60,z:15}],["Right Fielder",{x:150,y:20,z:15}],["Center-Right Fielder",{x:150,y:60,z:15}],["Center-Left Fielder",{x:60,y:150,z:15}],["Left Fielder",{x:20,y:150,z:15}]];function outfieldLineUp(e){return 1==awareCheck(e)?150:170}function inningStart(e,t,r=new NewGameState){t.roster,t.roster.slice(1,5).concat(t.roster[0]),e.roster;let n=defenseLineUp(e,r),l=offenseLineUp(t,r);for(let e=0;e<n.length;e++)"Batter"==n[e].role&&(r.batter=n[e],r.batter.hasBatted=!0,r.batter.atbats++);for(let e=0;e<l.length;e++)if(l[e].isOffense=!0,"Pitcher"==l[e].role)r.pitcher=l[e],r.pitcher.hasPitched=!0;else{if("Catcher"!=l[e].role)continue;r.catcher=l[e]}return r.offense=l,r.offensename=t.name,r.defense=n,r.defensename=e.name,r}function randomizedRoster(e){let t=e,r=[],n=5;for(let e=0;e<=n;n--){let e=randInt(0,n);r.push(t[e]);let l=t.slice(0,e),s=t.slice(e+1);t=l.concat(s)}return r}function defenseLineUp(e,t){let r=[],n=[["Infield Defender",{x:20,y:60,z:15}],["Right Fielder",{x:170,y:20,z:15}],["Center-Right Fielder",{x:170,y:60,z:15}],["Center-Left Fielder",{x:60,y:170,z:15}],["Left Fielder",{x:20,y:170,z:15}]];if(null==t.defense)for(let t=0;t<e.roster.length;t++)r.push(new PlayerInstance(e.roster[t]));else r=randomizedRoster(t.defense);for(let e=0;e<r.length;e++)if(0==r[e].hasBatted){r[e].role="Batter",r[e].position={x:0,y:0,z:15},r[e].atbats++;break}for(let e=0;e<n.length;e++)for(let t=0;t<r.length;t++)if(null==r[t].role){r[t].role=n[e][0],r[t].position=n[e][1];break}return r}function offenseLineUp(e,t){let r=[],n=[["First baseman",{x:90,y:20,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]];if(null==t.offense)for(let t=0;t<e.roster.length;t++)r.push(new PlayerInstance(e.roster[t]));else r=randomizedRoster(t.offense);for(let e=0;e<r.length;e++)if(0==r[e].hasCaught){r[e].role="Catcher",r[e].position={x:-2,y:-2,z:15};break}for(let e=0;e<r.length;e++)if(0==r[e].hasPitched&&"Catcher"!==r[e].role){r[e].role="Pitcher",r[e].hasPitched=!0,r[e].position={x:60,y:60,z:15};break}for(let e=0;e<n.length;e++)for(let t=0;t<r.length;t++)if(null==r[t].role){r[t].role=n[e][0],r[t].position=n[e][1];break}return r}function phaseResult(e,t,r,n=null){let l,s=n,a=e,o=new NewResult(a);if(1==a.pitcher.isRunner&&(a.pitcherrot=!0),0===e.phase){if(a.balls>=4&&(fs.writeFileSync(`${r}/${t}.txt`,`That's the fourth ball by ${a.pitcher.name}, and so the ${a.offensename} will have to rotate their pitchers, and the ${nthReturn(a.outs+1)} OUT is recorded.\n`,{flag:"a"},(e=>{if(e)throw e})),a.pitcher.ballouts++,a.outs++,a.pitcher.hasPitched=!0,a.pitcherrot=!0,a.balls=0,a.outs>=6))return o;if(a.fouls>=4&&(fs.writeFileSync(`${r}/${t}.txt`,`That's four foul balls by ${a.batter.name}, so the ${a.defensename} will bring in a new batter.\n`,{flag:"a"},(e=>{if(e)throw e})),a.fouls=0,a.batter.foulouts++,a.strikes=0,a.batter.hasBatted=!0,a.batterrot=!0),a.strikes>=3&&(fs.writeFileSync(`${r}/${t}.txt`,`That last strike was ${a.batter.name}'s third, so he'll have to rotate out.\n`,{flag:"a"},(e=>{if(e)throw e})),a.fouls=0,a.strikes=0,a.batter.hasBatted=!0,a.batter.strikeoutsbatting++,a.pitcher.strikeoutspitching++,a.batterrot=!0),1==a.catcherrot){let e=!1,n=rotateCatcher(a,t,r);a.offense=n.offense,a.catcher==a.pitcher&&(e=!0),a.pitcher=n.pitcher,fs.writeFileSync(`${r}/${t}.txt`,`${a.catcher.name} rotates over to catcher.\n`,{flag:"a"},(e=>{if(e)throw e})),1==e&&(fs.writeFileSync(`${r}/${t}.txt`,`${a.pitcher.name} takes his place on the mound.\n`,{flag:"a"},(e=>{if(e)throw e})),a.pitcherrot=!1,a.pitcher.hasPitched=!0,e=!1),a.catcherrot=!1}if(1==a.pitcherrot){let e=rotatePitcher(a,t,r);a.offense=e.offense,a.pitcher=e.pitcher,a.pitcher.hasPitched=!0}if(1==a.batterrot){let e=rotateBatter(a,t,r);a.defense=e.defense,a.batter=e.batter}a.resetPositions(),a.resetObjectives(),1!=a.pitcherrot&&1!=a.batterrot||(fs.writeFileSync(`${r}/${t}.txt`,`${a.pitcher.name} sets up on the mound as ${a.batter.name} steps into the box.\n`,{flag:"a"},(e=>{if(e)throw e})),a.pitcherrot=!1,a.batterrot=!1),o=atBat(a,t,r)}else if(1===e.phase){l=assignObjectives(a),a=a.update(l);let e=comparePursuit(a);a=a.update(e),logObjectives(a,t,r),o=doObjectives(a,t,r,s)}else 2===e.phase||3===e.phase?(l=assignObjectives(a),a=a.update(l),logObjectives(a,t,r),o=doObjectives(a,t,r,s)):4===e.phase&&(l=assignObjectives(a),a=a.update(l),"throw"==a.ballcarrier.objective&&logObjectives(a,t,r),o=doObjectives(a,t,r,s));return o}function runGame(e,t,r,n,l,s=null){let a,o,i,h,f,c,u,b,d,p,g=s,$=inningStart(e,t,r);for(let e=0;e<$.offense.length;e++)"First baseman"==$.offense[e].role&&(o=$.offense[e].name),"Second baseman"==$.offense[e].role&&(i=$.offense[e].name),"Shortstop"==$.offense[e].role&&(h=$.offense[e].name),"Third baseman"==$.offense[e].role&&(f=$.offense[e].name);for(let e=0;e<$.defense.length;e++)"Infield Defender"==$.defense[e].role&&(c=$.defense[e].name),"Right Fielder"==$.defense[e].role&&(u=$.defense[e].name),"Center-Right Fielder"==$.defense[e].role&&(b=$.defense[e].name),"Center-Left Fielder"==$.defense[e].role&&(d=$.defense[e].name),"Left Fielder"==$.defense[e].role&&(p=$.defense[e].name);fs.writeFileSync(`${l}/${n}.txt`,"Here's the lineup.\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${l}/${n}.txt`,"Offense:\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${l}/${n}.txt`,`Catcher: ${$.catcher.name}\n Pitcher: ${$.pitcher.name}\n First Baseman: ${o}\n Second Baseman: ${i}\n Shortstop: ${h}\n Third Baseman: ${f}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${l}/${n}.txt`,"Defense:\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${l}/${n}.txt`,`Batter: ${$.batter.name}\n Infield Defender: ${c}\n Right Fielder: ${u}\n Center-Right Fielder: ${b}\n Center-Left Fielder: ${d}\n Left Fielder: ${p}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${l}/${n}.txt`,`The players take their positions on the diamond, and we are set to begin as ${$.pitcher.name} sets up on the mound.\n\n`,{flag:"a"},(e=>{if(e)throw e}));do{a=phaseResult($,n,l,g),$=$.update(a)}while($.outs<6);return $}function fullGame(e,t,r,n){let l,s=0,a=0,o=1,i=[],h=1;if(fs.existsSync(`${n}/${r}.txt`)){let e=fs.readFileSync(`${n}/${r}.txt`,"utf8"),t=new RegExp(/Game \d/g),l=e.match(t);l.length>0&&(h=l.length+1)}fs.writeFileSync(`${n}/${r}.txt`,`Game ${h}\n\nWelcome to the matchup between the ${e.name} and the ${t.name}! Let's get started!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let i=0;i<12;i++)if(11===i){if(s>a){fs.writeFileSync(`${n}/${r}.txt`,`And so we reach the conclusion of this broadcast! Final score: home: ${s}, away: ${a}.\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,"Stats:\n",{flag:"a"},(e=>{if(e)throw e}));let e=[],t=new Table;for(let t of l.defense)e.push({name:t.name,pointsscored:t.pointsScored,assists:t.assists,assistpoints:t.assistpoints,brokentackles:t.brokentackles,ballsfieldedoff:t.ballsfieldedoff,blocks:t.blocks,turnovers:t.turnovers});e.forEach((function(e){t.cell("Name",e.name),t.cell("Points Scored",e.pointsscored),t.cell("Assists",e.assists),t.cell("Assist Points",e.assistpoints),t.cell("Broken Tackles",e.brokentackles),t.cell("Balls Fielded (OFF)",e.ballsfieldedoff),t.cell("Blocks",e.blocks),t.cell("Turnovers",e.turnovers),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,`${l.defensename}:\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,"OFFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.defense)e.push({name:t.name,pitches:t.pitches,strikes:t.strikes,balls:t.balls,fouls:t.fouls,strikeoutspitching:t.strikeoutspitching,ballouts:t.ballouts,slamsgiven:t.slamsgiven});e.forEach((function(e){t.cell("Name",e.name),t.cell("Pitches",e.pitches),t.cell("Strikes",e.strikes),t.cell("Balls",e.balls),t.cell("Fouls",e.fouls),t.cell("Strikeouts Pitching",e.strikeoutspitching),t.cell("Ball Outs",e.ballouts),t.cell("Slams Given",e.slamsgiven),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"PITCHING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.defense)e.push({name:t.name,atbats:t.atbats,hits:t.hits,slams:t.slams,hitstoout:t.hitstoout,hitstooffense:t.hitstooffense,foulouts:t.foulouts,strikeoutsbatting:t.strikeoutsbatting});e.forEach((function(e){t.cell("Name",e.name),t.cell("At-Bats",e.atbats),t.cell("Hits",e.hits),t.cell("Slams",e.slams),t.cell("Hits to Out",e.hitstoout),t.cell("Hits to Offense",e.hitstooffense),t.cell("Foulouts",e.foulouts),t.cell("Strikeouts Batting",e.strikeoutsbatting),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"BATTING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.defense)e.push({name:t.name,tackles:t.tackles,blocksshed:t.blocksshed,interceptions:t.interceptions,ballsfieldeddef:t.ballsfieldeddef,totaloutsrecorded:t.totaloutsrecorded});e.forEach((function(e){t.cell("Name",e.name),t.cell("Tackles",e.tackles),t.cell("Blocks Shed",e.blocksshed),t.cell("Interceptions",e.interceptions),t.cell("Balls Fielded (DEF)",e.ballsfieldeddef),t.cell("Total Outs Recorded",e.totaloutsrecorded),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"DEFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,"\n\n\n\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${l.offensename}\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.offense)e.push({name:t.name,pointsscored:t.pointsScored,assists:t.assists,assistpoints:t.assistpoints,brokentackles:t.brokentackles,ballsfieldedoff:t.ballsfieldedoff,blocks:t.blocks,turnovers:t.turnovers});e.forEach((function(e){t.cell("Name",e.name),t.cell("Points Scored",e.pointsscored),t.cell("Assists",e.assists),t.cell("Assist Points",e.assistpoints),t.cell("Broken Tackles",e.brokentackles),t.cell("Balls Fielded (OFF)",e.ballsfieldedoff),t.cell("Blocks",e.blocks),t.cell("Turnovers",e.turnovers),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"OFFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.offense)e.push({name:t.name,pitches:t.pitches,strikes:t.strikes,balls:t.balls,fouls:t.fouls,strikeoutspitching:t.strikeoutspitching,ballouts:t.ballouts,slamsgiven:t.slamsgiven});e.forEach((function(e){t.cell("Name",e.name),t.cell("Pitches",e.pitches),t.cell("Strikes",e.strikes),t.cell("Balls",e.balls),t.cell("Fouls",e.fouls),t.cell("Strikeouts Pitching",e.strikeoutspitching),t.cell("Ball Outs",e.ballouts),t.cell("Slams Given",e.slamsgiven),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"PITCHING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.offense)e.push({name:t.name,atbats:t.atbats,hits:t.hits,slams:t.slams,hitstoout:t.hitstoout,hitstooffense:t.hitstooffense,foulouts:t.foulouts,strikeoutsbatting:t.strikeoutsbatting});e.forEach((function(e){t.cell("Name",e.name),t.cell("At-Bats",e.atbats),t.cell("Hits",e.hits),t.cell("Slams",e.slams),t.cell("Hits to Out",e.hitstoout),t.cell("Hits to Offense",e.hitstooffense),t.cell("Foulouts",e.foulouts),t.cell("Strikeouts Batting",e.strikeoutsbatting),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"BATTING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),e=[],t=new Table;for(let t of l.offense)e.push({name:t.name,tackles:t.tackles,blocksshed:t.blocksshed,interceptions:t.interceptions,ballsfieldeddef:t.ballsfieldeddef,totaloutsrecorded:t.totaloutsrecorded});e.forEach((function(e){t.cell("Name",e.name),t.cell("Tackles",e.tackles),t.cell("Blocks Shed",e.blocksshed),t.cell("Interceptions",e.interceptions),t.cell("Balls Fielded (DEF)",e.ballsfieldeddef),t.cell("Total Outs Recorded",e.totaloutsrecorded),t.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"DEFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${t.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e}));break}{fs.writeFileSync(`${n}/${r}.txt`,"The bottom of the sixth is about to begin!\n",{flag:"a"},(e=>{if(e)throw e})),l=runGame(t,e,l,r,n,[s,a]),s+=l.score,fs.writeFileSync(`${n}/${r}.txt`,`home: ${s}, away: ${a}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`And so we reach the conclusion of this broadcast! Final score: home: ${s}, away: ${a}.\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,"Stats:\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${l.offensename}\n`,{flag:"a"},(e=>{if(e)throw e}));let o=[],i=new Table;for(let e of l.offense)o.push({name:e.name,pointsscored:e.pointsScored,assists:e.assists,assistpoints:e.assistpoints,brokentackles:e.brokentackles,ballsfieldedoff:e.ballsfieldedoff,blocks:e.blocks,turnovers:e.turnovers});o.forEach((function(e){i.cell("Name",e.name),i.cell("Points Scored",e.pointsscored),i.cell("Assists",e.assists),i.cell("Assist Points",e.assistpoints),i.cell("Broken Tackles",e.brokentackles),i.cell("Balls Fielded (OFF)",e.ballsfieldedoff),i.cell("Blocks",e.blocks),i.cell("Turnovers",e.turnovers),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"OFFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.offense)o.push({name:e.name,pitches:e.pitches,strikes:e.strikes,balls:e.balls,fouls:e.fouls,strikeoutspitching:e.strikeoutspitching,ballouts:e.ballouts,slamsgiven:e.slamsgiven});o.forEach((function(e){i.cell("Name",e.name),i.cell("Pitches",e.pitches),i.cell("Strikes",e.strikes),i.cell("Balls",e.balls),i.cell("Fouls",e.fouls),i.cell("Strikeouts Pitching",e.strikeoutspitching),i.cell("Ball Outs",e.ballouts),i.cell("Slams Given",e.slamsgiven),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"PITCHING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.offense)o.push({name:e.name,atbats:e.atbats,hits:e.hits,slams:e.slams,hitstoout:e.hitstoout,hitstooffense:e.hitstooffense,foulouts:e.foulouts,strikeoutsbatting:e.strikeoutsbatting});o.forEach((function(e){i.cell("Name",e.name),i.cell("At-Bats",e.atbats),i.cell("Hits",e.hits),i.cell("Slams",e.slams),i.cell("Hits to Out",e.hitstoout),i.cell("Hits to Offense",e.hitstooffense),i.cell("Foulouts",e.foulouts),i.cell("Strikeouts Batting",e.strikeoutsbatting),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"BATTING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.offense)o.push({name:e.name,tackles:e.tackles,blocksshed:e.blocksshed,interceptions:e.interceptions,ballsfieldeddef:e.ballsfieldeddef,totaloutsrecorded:e.totaloutsrecorded});o.forEach((function(e){i.cell("Name",e.name),i.cell("Tackles",e.tackles),i.cell("Blocks Shed",e.blocksshed),i.cell("Interceptions",e.interceptions),i.cell("Balls Fielded (DEF)",e.ballsfieldeddef),i.cell("Total Outs Recorded",e.totaloutsrecorded),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"DEFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,"\n\n\n\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${l.defensename}\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.defense)o.push({name:e.name,pointsscored:e.pointsScored,assists:e.assists,assistpoints:e.assistpoints,brokentackles:e.brokentackles,ballsfieldedoff:e.ballsfieldedoff,blocks:e.blocks,turnovers:e.turnovers});o.forEach((function(e){i.cell("Name",e.name),i.cell("Points Scored",e.pointsscored),i.cell("Assists",e.assists),i.cell("Assist Points",e.assistpoints),i.cell("Broken Tackles",e.brokentackles),i.cell("Balls Fielded (OFF)",e.ballsfieldedoff),i.cell("Blocks",e.blocks),i.cell("Turnovers",e.turnovers),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"OFFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.defense)o.push({name:e.name,pitches:e.pitches,strikes:e.strikes,balls:e.balls,fouls:e.fouls,strikeoutspitching:e.strikeoutspitching,ballouts:e.ballouts,slamsgiven:e.slamsgiven});o.forEach((function(e){i.cell("Name",e.name),i.cell("Pitches",e.pitches),i.cell("Strikes",e.strikes),i.cell("Balls",e.balls),i.cell("Fouls",e.fouls),i.cell("Strikeouts Pitching",e.strikeoutspitching),i.cell("Ball Outs",e.ballouts),i.cell("Slams Given",e.slamsgiven),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"PITCHING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.defense)o.push({name:e.name,atbats:e.atbats,hits:e.hits,slams:e.slams,hitstoout:e.hitstoout,hitstooffense:e.hitstooffense,foulouts:e.foulouts,strikeoutsbatting:e.strikeoutsbatting});o.forEach((function(e){i.cell("Name",e.name),i.cell("At-Bats",e.atbats),i.cell("Hits",e.hits),i.cell("Slams",e.slams),i.cell("Hits to Out",e.hitstoout),i.cell("Hits to Offense",e.hitstooffense),i.cell("Foulouts",e.foulouts),i.cell("Strikeouts Batting",e.strikeoutsbatting),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"BATTING\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table;for(let e of l.defense)o.push({name:e.name,tackles:e.tackles,blocksshed:e.blocksshed,interceptions:e.interceptions,ballsfieldeddef:e.ballsfieldeddef,totaloutsrecorded:e.totaloutsrecorded});o.forEach((function(e){i.cell("Name",e.name),i.cell("Tackles",e.tackles),i.cell("Blocks Shed",e.blocksshed),i.cell("Interceptions",e.interceptions),i.cell("Balls Fielded (DEF)",e.ballsfieldeddef),i.cell("Total Outs Recorded",e.totaloutsrecorded),i.newRow()})),fs.writeFileSync(`${n}/${r}.txt`,"DEFENSE\n",{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`${i.toString()}\n\n`,{flag:"a"},(e=>{if(e)throw e})),o=[],i=new Table}}else 0===i?(fs.writeFileSync(`${n}/${r}.txt`,`At the top of the ${nthReturn(o)}, we have the ${t.name} on offense. The ${e.name} take the field to defend.\n\n`,{flag:"a"},(e=>{if(e)throw e})),l=runGame(e,t,new NewGameState,r,n),a+=l.score,fs.writeFileSync(`${n}/${r}.txt`,`home: ${s}, away: ${a}\n\n`,{flag:"a"},(e=>{if(e)throw e})),s>a?o<6&&fs.writeFileSync(`${n}/${r}.txt`,`The ${e.name} lead by ${s-a}, and they'll be looking to add to that lead in the bottom of the ${nthReturn(o)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):a>s?fs.writeFileSync(`${n}/${r}.txt`,`The ${t.name} lead by ${a-s}, and they'll be looking to defend that lead in the bottom of the ${nthReturn(o)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${n}/${r}.txt`,`We are all tied up after the ${nthReturn(o)}. The ${e.name} will be looking to take the momentum in the bottom of  the ${nthReturn(o)}, which is set to begin.\n`,{flag:"a"},(e=>{if(e)throw e})),l=l.resetInning()):1===i?(fs.writeFileSync(`${n}/${r}.txt`,`Teams switch sides, and the ${e.name} line up on offense as we start the bottom of the ${nthReturn(o)}.\n\n`,{flag:"a"},(e=>{if(e)throw e})),l=runGame(t,e,l,r,n),s+=l.score,fs.writeFileSync(`${n}/${r}.txt`,`home: ${s}, away: ${a}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`That's the end of the ${nthReturn(o)} frame!\n`,{flag:"a"},(e=>{if(e)throw e})),s>a?fs.writeFileSync(`${n}/${r}.txt`,`The ${e.name} lead by ${s-a}, and they'll be looking to defend that lead in the top of the ${nthReturn(o+1)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):a>s?fs.writeFileSync(`${n}/${r}.txt`,`The ${t.name} lead by ${a-s}, and they'll be looking to add to that lead in the top of the ${nthReturn(o+1)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${n}/${r}.txt`,`We are all tied up after the ${nthReturn(o)}. The ${t.name} will be looking to take the momentum in the top of the ${nthReturn(o+1)}, which is set to begin.\n`,{flag:"a"},(e=>{if(e)throw e})),o++,l=l.resetInning()):i%2==0?(fs.writeFileSync(`${n}/${r}.txt`,`At the top of the ${nthReturn(o)}, we have the ${t.name} on offense. The ${e.name} take the field to defend.\n\n`,{flag:"a"},(e=>{if(e)throw e})),l=runGame(e,t,l,r,n),a+=l.score,fs.writeFileSync(`${n}/${r}.txt`,`home: ${s}, away: ${a}\n\n`,{flag:"a"},(e=>{if(e)throw e})),s>a?o<6&&fs.writeFileSync(`${n}/${r}.txt`,`The ${e.name} lead by ${s-a}, and they'll be looking to add to that lead in the bottom of the ${nthReturn(o)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):a>s?fs.writeFileSync(`${n}/${r}.txt`,`The ${t.name} lead by ${a-s}, and they'll be looking to defend that lead in the bottom of the ${nthReturn(o)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${n}/${r}.txt`,`We are all tied up after the ${nthReturn(o)}. The ${e.name} will be looking to take the momentum in the bottom of  the ${nthReturn(o)}, which is set to begin.\n`,{flag:"a"},(e=>{if(e)throw e})),l.resetInning()):(fs.writeFileSync(`${n}/${r}.txt`,`Teams switch sides, and the ${e.name} line up on offense as we start the bottom of the ${nthReturn(o)}.\n\n`,{flag:"a"},(e=>{if(e)throw e})),l=runGame(t,e,l,r,n),s+=l.score,fs.writeFileSync(`${n}/${r}.txt`,`home: ${s}, away: ${a}\n\n`,{flag:"a"},(e=>{if(e)throw e})),fs.writeFileSync(`${n}/${r}.txt`,`That's the end of the ${nthReturn(o)} frame!\n`,{flag:"a"},(e=>{if(e)throw e})),s>a?fs.writeFileSync(`${n}/${r}.txt`,`The ${e.name} lead by ${s-a}, and they'll be looking to defend that lead in the top of the ${nthReturn(o+1)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):a>s?fs.writeFileSync(`${n}/${r}.txt`,`The ${t.name} lead by ${a-s}, and they'll be looking to add to that lead in the top of the ${nthReturn(o+1)}, which will begin soon.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${n}/${r}.txt`,`We are all tied up after the ${nthReturn(o)}. The ${t.name} will be looking to take the momentum in the top of the ${nthReturn(o+1)}, which is set to begin.\n`,{flag:"a"},(e=>{if(e)throw e})),o++,l=l.resetInning());return i.push({home:s,away:a,hometeam:e.name,awayteam:t.name}),i.push(l.offense),i.push(l.defense),i}function nthReturn(e){return 1===e?"first":2==e?"second":3==e?"third":4==e?"fourth":5==e?"fifth":6==e?"sixth":void 0}function atBat(e,t,r){let n=new Pitch(e.pitcher,e.batter);fs.writeFileSync(`${r}/${t}.txt`,`${e.pitcher.name} winds up and throws a ${n.pitchspeed} MPH pitch!\n`,{flag:"a"},(e=>{if(e)throw e})),e.pitcher.pitches++;let l=new NewResult(e);if(1==n.hit){l.phase=1,l.ballpath=flightPath(e.batter.position,vectorMaker(e.batter));let n=l.ballpath[l.ballpath.length-1],s=areaReturn(n);if(n.x<0||n.y<0)return fs.writeFileSync(`${r}/${t}.txt`,`${e.batter.name} hits the ball, but it's out of bounds. Foul ball!\n`,{flag:"a"},(e=>{if(e)throw e})),l.fouls++,l.phase=0,l.ballpath=null,e.pitcher.fouls++,l;fs.writeFileSync(`${r}/${t}.txt`,`${e.batter.name} hits the ball ${s}!\n`,{flag:"a"},(e=>{if(e)throw e})),e.batter.hitter=!0,e.batter.hits++;for(let n=0;n<l.ballpath.length;n++)if((l.ballpath[n].x>300||l.ballpath[n].y>300)&&l.ballpath[n].z>0){fs.writeFileSync(`${r}/${t}.txt`,`And that's a SLAM for ${e.batter.name}! Bases are cleared and the ${nthReturn(e.outs+1)} OUT is recorded!\n`,{flag:"a"},(e=>{if(e)throw e})),l.onfirst.current=null,l.onfirst.previous=null,l.onsecond.current=null,l.onsecond.previous=null,l.onthird.current=null,l.onthird.previous=null,l.outs++,l.balls=-1*e.balls,l.pitcherrot=!0,e.batter.slams++,e.pitcher.slamsgiven++;for(let e=0;e<l.offense.length;e++)null!==l.offense[e].onBase&&(l.offense[e].onBase=null,l.offense[e].role=" ");return l.phase=0,l.outs+e.outs>=6&&fs.writeFileSync(`${r}/${t}.txt`,"And that slam ends the inning! Our score:\n",{flag:"a"},(e=>{if(e)throw e})),l}}else 1==n.ball?(fs.writeFileSync(`${r}/${t}.txt`,"Ball.\n",{flag:"a"},(e=>{if(e)throw e})),l.balls++,e.pitcher.balls++):1==n.strike&&(0==n.swingdecide?(fs.writeFileSync(`${r}/${t}.txt`,`${e.batter.name} watches it sail through the zone. Strike! And a possession play begins with Catcher ${e.catcher.name}!\n`,{flag:"a"},(e=>{if(e)throw e})),l.phase=4,l.strikes++,e.pitcher.strikes++,l.strikes>=3&&e.pitcher.strikeoutspitching++,l.ballcarrier=e.catcher,l.ballcarrier.isRunner=!0):(fs.writeFileSync(`${r}/${t}.txt`,`Swing and a miss! Possession play starts as Catcher ${e.catcher.name} fields the ball!\n`,{flag:"a"},(e=>{if(e)throw e})),l.phase=4,l.strikes++,e.pitcher.strikes++,l.ballcarrier=e.catcher,l.ballcarrier.isRunner=!0));return l}function areaReturn(e){let t;return e.x<60&&e.y<60?t="to shallow infield":e.x>=60&&e.x<100&&e.y<60?t="between first and second":e.x>=60&&e.x<100&&e.y>=60&&e.y<100?t="towards center infield":e.x<60&&e.y>=60&&e.y<100?t="between second and third":e.x>=100&&e.x<200&&e.y<100?t="towards right field":e.x>=200&&e.y<100?t="towards deep right field":e.x>=100&&e.x<200&&e.y>=100||e.y>=100&&e.y<200&&e.x>=100?t="towards center field":e.x>=200&&e.y>=200?t="towards deep center field":e.x<100&&e.y>=100&&e.y<200?t="towards left field":e.x<100&&e.y>=200&&(t="towards deep left field"),t}function assignObjectives(e){let t=new NewResult(e),r=[];for(let t=0;t<e.offense.length;t++)1==e.offense[t].isRunner&&r.push(e.offense[t]);t.runners=r;let n=[],l=[null,"first","second","third"];if(r.length>1){for(let e=0;e<l.length;e++)for(let t=0;t<r.length;t++)r[t].onBase==l[e]&&n.push(r[t]);t.runners=n}if(1===e.phase){let r=e.ballpath,n=[],l=[];for(let e=0;e<t.defense.length;e++)"Batter"!==t.defense[e].role&&(t.defense[e].path=singleInterceptPath(t.defense[e],t.defense[e].position,r),t.defense[e].objective="pursue the ball");for(let e=0;e<t.defense.length;e++)null==t.defense[e].path||t.defense[e].path.length<1?n.push(1e3):n.push(t.defense[e].path.length);let s=n[0];for(let e=0;e<n.length;e++)n[e]<=s&&(s=n[e]);let a=n.indexOf(s);for(let e=0;e<t.defense.length;e++)(t.defense.indexOf(t.defense[e])!==a||null!==t.defense[e].path&&t.defense[e].path.length<1)&&(t.defense[e].objective=null,t.defense[e].path=null);for(let e=0;e<t.offense.length;e++)0==t.offense[e].isRunner&&(t.offense[e].path=singleInterceptPath(t.offense[e],t.offense[e].position,r),t.offense[e].objective="pursue the ball");for(let e=0;e<t.offense.length;e++)null==t.offense[e].path||t.offense[e].path.length<1?l.push(1e3):l.push(t.offense[e].path.length);let o=l[0];for(let e=0;e<l.length;e++)l[e]<=o&&(o=l[e]);let i=l.indexOf(o);for(let e=0;e<t.offense.length;e++)t.offense.indexOf(t.offense[e])!==i&&(t.offense[e].objective=null,t.offense[e].path=null)}else if(2===e.phase){let r=!1;if(t.runners.length>0){null!==e.ballcarrier&&(null==e.ballcarrier.onBase||1==e.ballcarrier.isReceiver?(t.ballcarrier.objective="run to next base",t.ballcarrier.target=nextbaseReturnString(e.ballcarrier),t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,nextbaseReturnObject(e.ballcarrier),[]),"first"==e.ballcarrier.onBase?(t.onfirst.current=null,t.onfirst.previous=t.ballcarrier):"second"==e.ballcarrier.onBase?(t.onsecond.current=null,t.onsecond.previous=t.ballcarrier):"third"==e.ballcarrier.onBase&&(t.onthird.current=null,t.onthird.previous=t.ballcarrier)):"first"==e.ballcarrier.onBase?(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,second,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),"stay on base"==t.ballcarrier.objective?(t.ballcarrier.target=null,t.ballcarrier.path=null,t.ballcarrier.wasBallcarrier=!0,t.ballcarrier=null):(t.ballcarrier.target="second",t.ballcarrier.role="Ballcarrier",t.onfirst.current=null,t.onfirst.previous=e.ballcarrier)):"second"==e.ballcarrier.onBase?(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,third,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),"stay on base"==t.ballcarrier.objective?(t.ballcarrier.target=null,t.ballcarrier.path=null,t.ballcarrier.wasBallcarrier=!0,t.ballcarrier=null):(t.ballcarrier.target="third",t.ballcarrier.role="Ballcarrier",t.onsecond.current=null,t.onsecond.previous=e.ballcarrier)):"third"==e.ballcarrier.onBase&&(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,home,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),"stay on base"==t.ballcarrier.objective?(t.ballcarrier.target=null,t.ballcarrier.path=null,t.ballcarrier.wasBallcarrier=!0,t.ballcarrier=null):(t.ballcarrier.target="home",t.ballcarrier.role="Ballcarrier",t.onthird.current=null,t.onthird.previous=e.ballcarrier)));for(let e=0;e<t.runners.length;e++)null!==t.ballcarrier&&t.ballcarrier.target==t.runners[e].onBase?(t.runners[e].isForced=!0,t.runners[e].objective="run to next base",t.runners[e].target=nextbaseReturnString(t.runners[e]),t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),"first"==t.runners[e].onBase?(t.onfirst.current=null,t.onfirst.previous=t.runners[e]):"second"==t.runners[e].onBase?(t.onsecond.current=null,t.onsecond.previous=t.runners[e]):"third"==t.runners[e].onBase&&(t.onthird.current=null,t.onthird.previous=t.runners[e])):"first"==t.runners[e].onBase&&t.runners[e]!==t.ballcarrier&&0==t.runners[e].wasBallcarrier?(t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),t.runners[e].objective=baserunningAI(t.runners[e],t),"stay on base"==t.runners[e].objective?(t.runners[e].target=null,t.runners[e].path=null):(t.runners[e].target=nextbaseReturnString(t.runners[e]),t.onfirst.current=null,t.onfirst.previous=t.runners[e])):"second"==t.runners[e].onBase&&t.runners[e]!==t.ballcarrier&&0==t.runners[e].wasBallcarrier?null===t.onfirst.previous||1!=t.onfirst.previous.isForced&&"run to next base"!=t.onfirst.previous.objective?(t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),t.runners[e].objective=baserunningAI(t.runners[e],t),"stay on base"==t.runners[e].objective?(t.runners[e].target=null,t.runners[e].path=null):(t.runners[e].target=nextbaseReturnString(t.runners[e]),t.onsecond.current=null,t.onsecond.previous=t.runners[e])):(t.runners[e].isForced=!0,t.runners[e].objective="run to next base",t.runners[e].target=nextbaseReturnString(t.runners[e]),t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),t.onsecond.current=null,t.onsecond.previous=t.runners[e]):"third"==t.runners[e].onBase&&t.runners[e]!==t.ballcarrier&&0==t.runners[e].wasBallcarrier&&(null===t.onsecond.previous||1!=t.onsecond.previous.isForced&&"run to next base"!=t.onsecond.previous.objective?(t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),t.runners[e].objective=baserunningAI(t.runners[e],t),"stay on base"==t.runners[e].objective?(t.runners[e].target=null,t.runners[e].path=null):(t.runners[e].target=nextbaseReturnString(t.runners[e]),t.onthird.current=null,t.onthird.previous=t.runners[e])):(t.runners[e].isForced=!0,t.runners[e].objective="run to next base",t.runners[e].target=nextbaseReturnString(t.runners[e]),t.runners[e].path=runPath(t.runners[e],t.runners[e].position,nextbaseReturnObject(t.runners[e]),[]),t.onthird.current=null,t.onthird.previous=t.runners[e]));if(t.runners.length<1)r=!1;else for(let e=0;e<t.runners.length;e++)if("run to next base"===t.runners[e].objective){r=!0;break}if(1==r){for(let r=0;r<e.defense.length;r++)if("Batter"!==e.defense[r].role)if(null===e.ballcarrier||"home"!=e.ballcarrier.target&&"third"!=e.ballcarrier.target&&"second"!=e.ballcarrier.target)if(null!==e.onthird.previous&&"run to next base"==e.onthird.previous.objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onthird.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onthird.previous.path.length;t++)if(s.x===e.onthird.previous.path[t].x&&s.y===e.onthird.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onthird.previous,t.defense[r].path=n)}else if(null!==e.onsecond.previous&&"run to next base"==e.onsecond.previous.objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onsecond.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onsecond.previous.path.length;t++)if(s.x===e.onsecond.previous.path[t].x&&s.y===e.onsecond.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onsecond.previous,t.defense[r].path=n)}else if(null!==e.onfirst.previous&&"run to next base"==e.onfirst.previous.objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onfirst.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onfirst.previous.path.length;t++)if(s.x===e.onfirst.previous.path[t].x&&s.y===e.onfirst.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onfirst.previous,t.defense[r].path=n)}else{if(null===e.ballcarrier||"first"!=e.ballcarrier.target)continue;{let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.ballcarrier.path),l=0,s=n[n.length-1];for(let t=0;t<e.ballcarrier.path.length;t++)if(s.x===e.ballcarrier.path[t].x&&s.y===e.ballcarrier.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.ballcarrier,t.defense[r].path=n)}}else{let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.ballcarrier.path),l=0,s=n[n.length-1];for(let t=0;t<e.ballcarrier.path.length;t++)if(s.x===e.ballcarrier.path[t].x&&s.y===e.ballcarrier.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.ballcarrier,t.defense[r].path=n)}let r=[],n=[],l=[];for(let t=0;t<e.offense.length;t++)0==e.offense[t].isRunner&&e.offense[t]!==e.ballcarrier&&l.push(e.offense[t]);for(let t=0;t<e.defense.length;t++)"tackle"==e.defense[t].objective&&r.push(e.defense[t]);for(let e=0;e<l.length;e++)if(r.length>0){for(let t=0;t<r.length;t++){let s=singleInterceptPath(l[e],l[e].position,r[t].path),a=0,o=s[s.length-1];for(let e=0;e<r[t].path.length;e++)if(o.x===r[t].path[e].x&&o.y===r[t].path[e].y){a=e;break}if(s.length-1<=a){let e={objective:"block",target:r[t],path:s};n.push(e)}else{let e={objective:null,target:null,path:{length:1e3}};n.push(e)}}let s,a=[],o=[];for(let e of n)a.push(e.path.length);for(let e=0;e<n.length;e++){s=1e3;for(let e=0;e<a.length;e++)s>a[e]&&(s=a[e]);let e=a.indexOf(s);o.push(n[e]),a[e]=1e3}n=o;let i=n[0];for(let e=0;e<n.length;e++)if(i.path.length<=n[e].path.length)if(n.length>1&&null!==n[e].objective){let r=0,l=0;for(let s=0;s<t.offense.length;s++)n[e].target==t.offense[s].target?(r+=1,l+=1):"block"==t.offense[s].objective&&(l+=1);if(0===r||r==l)continue;i=n[e]}else i=n[e];else i=n[e];l[e].objective=i.objective,l[e].target=i.target,l[e].path=i.path,i=[],n=[]}}}}else if(3===e.phase){if(1==e.ballcarrier.isReceiver?(t.ballcarrier.objective="run to next base",t.ballcarrier.target=nextbaseReturnString(e.ballcarrier),t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,nextbaseReturnObject(e.ballcarrier),[]),"first"==e.ballcarrier.onBase?(t.onfirst.current=null,t.onfirst.previous=t.ballcarrier):"second"==e.ballcarrier.onBase?(t.onsecond.current=null,t.onsecond.previous=t.ballcarrier):"third"==e.ballcarrier.onBase&&(t.onthird.current=null,t.onthird.previous=t.ballcarrier)):null==e.ballcarrier.onBase?(t.ballcarrier.objective="run to next base",t.ballcarrier.target="first",t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,first,[])):"first"==e.ballcarrier.onBase?(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,second,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),(t.ballcarrier.objective="stay on base")?(t.ballcarrier.target=null,t.ballcarrier.path=null):(t.ballcarrier.target="second",t.onfirst.current=null,t.onfirst.previous=e.ballcarrier)):"second"==e.ballcarrier.onBase?(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,third,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),(t.ballcarrier.objective="stay on base")?(t.ballcarrier.target=null,t.ballcarrier.path=null):(t.ballcarrier.target="third",t.onsecond.current=null,t.onsecond.previous=e.ballcarrier)):"third"==e.ballcarrier.onBase&&(t.ballcarrier.path=runPath(t.ballcarrier,t.ballcarrier.position,home,[]),t.ballcarrier.objective=baserunningAI(t.ballcarrier,e),(t.ballcarrier.objective="stay on base")?(t.ballcarrier.target=null,t.ballcarrier.path=null):(t.ballcarrier.target="home",t.onthird.current=null,t.onthird.previous=e.ballcarrier)),t.runners.length>0)for(let r=0;r<t.runners.length;r++)t.runners[r]!==t.ballcarrier&&(t.ballcarrier.target==t.runners[r].onBase?(t.runners[r].isForced=!0,t.runners[r].objective="run to next base",t.runners[r].target=nextbaseReturnString(t.runners[r]),t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),"first"==t.runners[r].onBase?(t.onfirst.current=null,t.onfirst.previous=t.runners[r]):"second"==t.runners[r].onBase?(t.onsecond.current=null,t.onsecond.previous=t.runners[r]):"third"==t.runners[r].onBase&&(t.onthird.current=null,t.onthird.previous=t.runners[r])):"first"==t.runners[r].onBase?(t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),t.runners[r].objective=baserunningAI(t.runners[r],e),"stay on base"==t.runners[r].objective?(t.runners[r].target=null,t.runners[r].path=null):(t.runners[r].target=nextbaseReturnString(t.runners[r]),t.onfirst.current=null,t.onfirst.previous=t.runners[r])):"second"==t.runners[r].onBase?null===t.onfirst.previous||1!=t.onfirst.previous.isForced&&"run to next base"!=t.onfirst.previous.objective?(t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),t.runners[r].objective=baserunningAI(t.runners[r],e),(t.runners[r].objective="stay on base")?(t.runners[r].target=null,t.runners[r].path=null):(t.runners[r].target=nextbaseReturnString(t.runners[r]),t.onsecond.current=null,t.onsecond.previous=t.runners[r])):(t.runners[r].isForced=!0,t.runners[r].objective="run to next base",t.runners[r].target=nextbaseReturnString(t.runners[r]),t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),t.onsecond.current=null,t.onsecond.previous=t.runners[r]):"third"==t.runners[r].onBase&&(null===t.onsecond.previous||1!=t.onsecond.previous.isForced&&"run to next base"!=e.onsecond.current.objective?(t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),t.runners[r].objective=baserunningAI(t.runners[r],e),(t.runners[r].objective="stay on base")?(t.runners[r].target=null,t.runners[r].path=null):(t.runners[r].target=nextbaseReturnString(t.runners[r]),t.onthird.current=null,t.onthird.previous=t.runners[r])):(t.runners[r].isForced=!0,t.runners[r].objective="run to next base",t.runners[r].target=nextbaseReturnString(t.runners[r]),t.runners[r].path=runPath(t.runners[r],t.runners[r].position,nextbaseReturnObject(t.runners[r]),[]),t.onthird.current=null,t.onthird.previous=t.runners[r])));for(let r=0;r<e.defense.length;r++)if("Batter"!==e.defense[r].role&&"tackle"!==e.defense[r].objective){if("home"==e.ballcarrier.target||"third"==e.ballcarrier.target||"second"==e.ballcarrier.target){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.ballcarrier.path),l=0,s=n[n.length-1];for(let t=0;t<e.ballcarrier.path.length;t++)if(s.x===e.ballcarrier.path[t].x&&s.y===e.ballcarrier.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.ballcarrier,t.defense[r].path=n)}else if(null!==e.onthird.previous&&"run to next base"==e.onthird.previous.objective&&"tackle"!==e.defense[r].objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onthird.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onthird.previous.path.length;t++)if(s.x===e.onthird.previous.path[t].x&&s.y===e.onthird.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onthird.previous,t.defense[r].path=n)}if(null!==e.onsecond.previous&&"run to next base"==e.onsecond.previous.objective&&"tackle"!==e.defense[r].objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onsecond.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onsecond.previous.path.length;t++)if(s.x===e.onsecond.previous.path[t].x&&s.y===e.onsecond.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onsecond.previous,t.defense[r].path=n)}if(null!==e.onfirst.previous&&"run to next base"==e.onfirst.previous.objective&&"tackle"!==e.defense[r].objective){let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.onfirst.previous.path),l=0,s=n[n.length-1];for(let t=0;t<e.onfirst.previous.path.length;t++)if(s.x===e.onfirst.previous.path[t].x&&s.y===e.onfirst.previous.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.onfirst.previous,t.defense[r].path=n)}if("first"!=e.ballcarrier.target||"tackle"===e.defense[r].objective)continue;{let n=singleInterceptPath(e.defense[r],e.defense[r].position,e.ballcarrier.path),l=0,s=n[n.length-1];for(let t=0;t<e.ballcarrier.path.length;t++)if(s.x===e.ballcarrier.path[t].x&&s.y===e.ballcarrier.path[t].y){l=t;break}n.length-1<=l&&(t.defense[r].objective="tackle",t.defense[r].target=e.ballcarrier,t.defense[r].path=n)}}let r=[],n=[],l=[];for(let t=0;t<e.offense.length;t++)0==e.offense[t].isRunner&&e.offense[t]!==e.ballcarrier&&l.push(e.offense[t]);for(let t=0;t<e.defense.length;t++)"tackle"==e.defense[t].objective&&r.push(e.defense[t]);for(let e=0;e<l.length;e++)if(r.length>0){for(let t=0;t<r.length;t++){let s=singleInterceptPath(l[e],l[e].position,r[t].path),a=0,o=s[s.length-1];for(let e=0;e<r[t].path.length;e++)if(o.x===r[t].path[e].x&&o.y===r[t].path[e].y){a=e;break}if(s.length-1<=a){let e={objective:"block",target:r[t],path:s};n.push(e)}else{let e={objective:null,target:null,path:{length:1e3}};n.push(e)}}let s,a=[],o=[];for(let e of n)a.push(e.path.length);for(let e=0;e<n.length;e++){s=1e3;for(let e=0;e<a.length;e++)s>a[e]&&(s=a[e]);let e=a.indexOf(s);o.push(n[e]),a[e]=1e3}n=o;let i=n[0];for(let e=0;e<n.length;e++)if(i.path.length<=n[e].path.length)if(n.length>1&&null!==n[e].objective){let l=0,s=0;for(let r=0;r<t.offense.length;r++)n[e].target==t.offense[r].target?(l+=1,s+=1):"block"==t.offense[r].objective&&(s+=1);if(0===l){i=n[e];break}s%r.length!=0&&s%r.length!==0+l||(i=n[e])}else i=n[e];else i=n[e],e--;l[e].objective=i.objective,l[e].target=i.target,l[e].path=i.path,n=[],i=[]}}else if(4===e.phase){let r=throwOrRun(e);1==r.throw?(t.ballcarrier.objective="throw",t.ballcarrier.target=r.target,t.ballcarrier.path=r.path,t.ballcarrier.onBase="throwing currently!"):t.phase=3}return t}function rotateCatcher(e,t,r){let n=e,l=[],s=[],a={onfirst:!1,onsecond:!1,onthird:!1},o=[["Pitcher",{x:60,y:60,z:15}],["First baseman",{x:90,y:20,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}]],i=[["Pitcher",{x:60,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],h=[["Pitcher",{x:60,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],f=[["Pitcher",{x:60,y:60,z:15}],["Third baseman",{x:20,y:90,z:15}]],c=[["Pitcher",{x:60,y:60,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],u=[["Pitcher",{x:60,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],b=[["Pitcher",{x:60,y:60,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]],d=[["Pitcher",{x:60,y:60,z:15}],["First baseman",{x:90,y:20,z:15}],["Second baseman",{x:90,y:60,z:15}],["Shortstop",{x:60,y:90,z:15}],["Third baseman",{x:20,y:90,z:15}]];for(let e=0;e<n.offense.length;e++)null!==n.offense[e].onBase?"first"==n.offense[e].onBase?a.onfirst=!0:"second"==n.offense[e].onBase?a.onsecond=!0:"third"==n.offense[e].onBase&&(a.onthird=!0):("Catcher"!==n.offense[e].role||(n.offense[e].role=" "),l.push(n.offense[e]));for(let e=0;e<l.length;e++)0==l[e].hasCaught&&s.push(l[e]);if(s.length<1){for(let e=0;e<n.offense.length;e++)n.offense[e].hasCaught=!1;return fs.writeFileSync(`${r}/${t}.txt`,"All team catchers have caught, so the rotation is refreshed.\n",{flag:"a"},(e=>{if(e)throw e})),n.catcher.hasCaught=!0,rotateCatcher(n)}if(n.catcher=s[0],n.catcher.role="Catcher",n.catcher.position={x:-2,y:-2,z:15},n.catcher.hasCaught=!0,3===l.length){let e=0;for(let t=0;t<f.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=f[t][0],n.offense[e].position=f[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else if(4===l.length){let e=0;if(1==a.onfirst&&1==a.onsecond){for(let t=0;t<i.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=i[t][0],n.offense[e].position=i[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else if(1==a.onfirst&&1==a.onthird){for(let t=0;t<h.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=h[t][0],n.offense[e].position=h[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else for(let t=0;t<u.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=u[t][0],n.offense[e].position=u[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else if(5===l.length){let e=0;if(1==a.onfirst){for(let t=0;t<o.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=o[t][0],n.offense[e].position=o[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else if(1==a.onsecond){for(let t=0;t<c.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=c[t][0],n.offense[e].position=c[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else for(let t=0;t<b.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=b[t][0],n.offense[e].position=b[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}else{let e=0;for(let t=0;t<d.length;t++)for(;e<n.offense.length;e++)if("Catcher"!=n.offense[e].role&&null===n.offense[e].onBase){n.offense[e].role=d[t][0],n.offense[e].position=d[t][1],"Pitcher"==n.offense[e].role&&(n.offense[e].hasPitched=!0,n.pitcher=n.offense[e]),e++;break}}return{offense:n.offense,pitcher:n.pitcher}}function rotatePitcher(e,t,r){let n=e,l=null;for(let e=0;e<n.offense.length;e++)if("Catcher"!==n.offense[e].role&&null==n.offense[e].onBase&&0==n.offense[e].hasPitched){l=n.offense[e];break}if(null==l){fs.writeFileSync(`${r}/${t}.txt`,`All ${n.offensename} pitchers have pitched, so the rotation resets.\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e=0;e<n.offense.length;e++)n.offense[e].hasPitched=!1;return rotatePitcher(n)}let s=l.role;return n.pitcher.role=s,l.role="Pitcher",{offense:n.offense,pitcher:l}}function rotateBatter(e,t,r){let n=e,l=null;for(let e=0;e<n.defense.length;e++)if(0==n.defense[e].hasBatted){l=n.defense[e],n.defense[1].atbats++;break}if(null==l){fs.writeFileSync(`${r}/${t}.txt`,`All ${n.defensename} batters have batted this inning, so the rotation is cleared.\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e=0;e<n.defense.length;e++)n.defense[e].hasBatted=!1;return rotateBatter(n)}let s=l.role;return n.batter.role=s,l.role="Batter",{defense:n.defense,batter:l}}function nextbaseReturnString(e){let t;return t="first"==e.onBase?"second":"second"==e.onBase?"third":"third"==e.onBase?"home":"first",t}function nextbaseReturnObject(e){let t;return t="first"==e.onBase?second:"second"==e.onBase?third:"third"==e.onBase?home:first,t}function baserunningAI(e,t){let r,n=t.defense,l=[],s=[];for(let r=0;r<n.length;r++)if("Batter"!=n[r].role){let n=singleInterceptPath(t.defense[r],t.defense[r].position,e.path),a=0,o=n[n.length-1];for(let t=0;t<e.path.length;t++)if(o.x===e.path[t].x&&o.y===e.path[t].y){a=t;break}n.length-1<=a&&(l.push(n),s.push(r))}if(l.length<1)r="run to next base";else for(let t=0;t<s.length;t++){if("Bad."==tackleOdds(e,n[s[t]])){r="stay on base";break}r="run to next base"}return r}function tackleOdds(e,t){let r=0;for(let n=0;n<10;n++)1==tackleCheck(e,t)&&r++;return 1==awareCheck(e)?r>=5?"Bad.":"Good.":randInt(1,10)<5?"Bad.":"Good."}function comparePursuit(e){let t=new NewResult(e),r=0,n=0;for(let t=0;t<e.offense.length;t++)"pursue the ball"==e.offense[t].objective&&(r=e.offense[t].path.length);for(let t=0;t<e.defense.length;t++)"pursue the ball"==e.defense[t].objective&&(n=e.defense[t].path.length);if(r>n?(r=!1,n=!0):r===n?(r=!0,n=!0):(n=!1,r=!0),0==r)for(let e=0;e<t.offense.length;e++)"pursue the ball"==t.offense[e].objective&&(t.offense[e].objective=null,t.offense[e].path=null);else if(0==n)for(let e=0;e<t.defense.length;e++)"pursue the ball"==t.defense[e].objective&&(t.defense[e].objective=null,t.defense[e].path=null);return t}function logObjectives(e,t,r){let n=e,l=[],s=[],a=[],o=[],i=[];for(let e=0;e<n.offense.length;e++)"pursue the ball"==n.offense[e].objective?l.push(n.offense[e]):"run to next base"==n.offense[e].objective?a.push(n.offense[e]):"block"==n.offense[e].objective&&i.push(n.offense[e]);for(let e=0;e<n.defense.length;e++)"pursue the ball"==n.defense[e].objective?s.push(n.defense[e]):"tackle"==n.defense[e].objective&&o.push(n.defense[e]);if(null!==n.ballcarrier&&"throw"!==n.ballcarrier.objective&&"stay on base"!==n.ballcarrier.objective){fs.writeFileSync(`${r}/${t}.txt`,`${n.ballcarrier.name} heads towards ${n.ballcarrier.target}!\n`,{flag:"a"},(e=>{if(e)throw e})),null!==n.onfirst.previous&&1==n.onfirst.previous.isForced&&null!=n.onsecond.previous&&1==n.onsecond.previous.isForced&&null!=n.onthird.previous&&1==n.onthird.previous.isForced?fs.writeFileSync(`${r}/${t}.txt`,"All runners are forced to advance!\n",{flag:"a"},(e=>{if(e)throw e})):null!==n.onfirst.previous&&1==n.onfirst.previous.isForced&&null!==n.onsecond.previous&&1==n.onsecond.previous.isForced?fs.writeFileSync(`${r}/${t}.txt`,"The first and second base runners are forced to advance!\n",{flag:"a"},(e=>{if(e)throw e})):null!==n.onfirst.previous&&1==n.onfirst.previous.isForced?fs.writeFileSync(`${r}/${t}.txt`,"The first base runner is forced to advance!\n",{flag:"a"},(e=>{if(e)throw e})):null!==n.onsecond.previous&&1==n.onsecond.previous.isForced&&null!=n.onthird.previous&&1==n.onthird.previous.isForced?fs.writeFileSync(`${r}/${t}.txt`,"The second and third base runners are forced to advance!\n",{flag:"a"},(e=>{if(e)throw e})):null!==n.onsecond.previous&&1==n.onsecond.previous.isForced?fs.writeFileSync(`${r}/${t}.txt`,"The second base runner is forced to advance!\n",{flag:"a"},(e=>{if(e)throw e})):null!==n.onthird.previous&&1==n.onthird.previous.isForced&&fs.writeFileSync(`${r}/${t}.txt`,"The third base runner is forced to advance!\n",{flag:"a"},(e=>{if(e)throw e}));let e,l=[];for(let e=0;e<n.defense.length;e++)"tackle"==n.defense[e].objective&&n.defense[e].target==n.ballcarrier&&l.push(n.defense[e]);if(l.length<1)e=`Ballcarrier ${n.ballcarrier.name} has a clear path to the base!`;else if(1===l.length)e=`${l[0].role} ${l[0].name} barrels towards the ballcarrier!`;else if(2===l.length)e=`${l[0].role} ${l[0].name} and ${l[1].role} ${l[1].name} head straight for the ballcarrier!`;else for(let t=0;t<l.length;t++)t===l.length-1?e+=`, and ${l[t].role} ${l[t].name} move to make the stop on the ballcarrier!`:0===t?e=`${l[t].role} ${l[t].name}`:e+=`, ${l[t].role} ${l[t].name}`;if(fs.writeFileSync(`${r}/${t}.txt`,`${e}\n`,{flag:"a"},(e=>{if(e)throw e})),i.length>0&&l.length>0){let e,s=[];for(let e=0;e<n.offense.length;e++)"block"==n.offense[e].objective&&l.includes(n.offense[e].target)&&s.push(n.offense[e]);if(1===s.length)e=`${s[0].role} ${s[0].name} comes to block!`;else if(2===s.length)e=`${s[0].role} ${s[0].name} and ${s[1].role} ${s[1].name} move to block!`;else for(let t=0;t<s.length;t++)t===s.length-1?e+=`, and ${s[t].role} ${s[t].name} try to form a wall for ${n.ballcarrier.name}!`:0===t?e=`${s[t].role} ${s[t].name}`:e+=`, ${s[t].role} ${s[t].name}`;fs.writeFileSync(`${r}/${t}.txt`,`${e}\n`,{flag:"a"},(e=>{if(e)throw e}))}}else null!==n.ballcarrier&&"throw"==n.ballcarrier.objective&&fs.writeFileSync(`${r}/${t}.txt`,`${n.ballcarrier.name} throws the ball to ${n.ballcarrier.target.name}!\n`,{flag:"a"},(e=>{if(e)throw e}));if(null!==n.onthird.current&&"stay on base"==n.onthird.current.objective)0==n.onthird.current.wasBallcarrier?fs.writeFileSync(`${r}/${t}.txt`,`Third base runner ${n.onthird.current.name} stays on third.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,`Ballcarrier ${n.onthird.current.name} stays on third.\n`,{flag:"a"},(e=>{if(e)throw e}));else if(null!==n.onthird.previous&&n.onthird.previous!==n.ballcarrier&&"run to next base"==n.onthird.previous.objective){let e,l,s=`Third base runner ${n.onthird.previous.name} advances towards home`,a=[];for(let e=0;e<n.defense.length;e++)"tackle"==n.defense[e].objective&&n.defense[e].target==n.onthird.previous&&a.push(n.defense[e]);if(a.length<1)e=" and the basepath is clear!";else if(1===a.length)e=`, but ${a[0].role} ${a[0].name} barrels towards him!`;else if(2===a.length)e=`, but ${a[0].role} ${a[0].name} and ${a[1].role} ${a[1].name} head straight for him!`;else for(let t=0;t<a.length;t++)t===a.length-1?e+=`, and ${a[t].role} ${a[t].name} head to make the stop!`:e+=0===t?`, but ${a[t].role} ${a[t].name}`:`${a[t].role} ${a[t].name}`;fs.writeFileSync(`${r}/${t}.txt`,`${s+e}\n`,{flag:"a"},(e=>{if(e)throw e}));let o=[];for(let e=0;e<n.offense.length;e++)"block"==n.offense[e].objective&&a.includes(n.offense[e].target)&&o.push(n.offense[e]);if(1===o.length)l=`${o[0].role} ${o[0].name} comes to block!`;else if(2===o.length)l=`${o[0].role} ${o[0].name} and ${o[1].role} ${o[1].name} move to block!`;else for(let e=0;e<o.length;e++)e===o.length-1?l+=`, and ${o[e].role} ${o[e].name} try to form a wall for ${n.onthird.previous.name}!`:0===e?l=`${o[e].role} ${o[e].name}`:l+=`, ${o[e].role} ${o[e].name}`;o.length>0&&fs.writeFileSync(`${r}/${t}.txt`,`${l}\n`,{flag:"a"},(e=>{if(e)throw e}))}if(null!==n.onsecond.current&&"stay on base"==n.onsecond.current.objective)0==n.onsecond.current.wasBallcarrier?fs.writeFileSync(`${r}/${t}.txt`,`Second base runner ${n.onsecond.current.name} stays on second.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,`Ballcarrier ${n.onsecond.current.name} stays on second.\n`,{flag:"a"},(e=>{if(e)throw e}));else if(null!==n.onsecond.previous&&n.onsecond.previous!==n.ballcarrier&&"run to next base"==n.onsecond.previous.objective){let e,l,s=`Second base runner ${n.onsecond.previous.name} advances towards third`,a=[];for(let e=0;e<n.defense.length;e++)"tackle"==n.defense[e].objective&&n.defense[e].target==n.onsecond.previous&&a.push(n.defense[e]);if(a.length<1)e=" and the basepath is clear!";else if(1===a.length)e=`, but ${a[0].role} ${a[0].name} barrels towards him!`;else if(2===a.length)e=`, but ${a[0].role} ${a[0].name} and ${a[1].role} ${a[1].name} head straight for him!`;else for(let t=0;t<a.length;t++)t===a.length-1?e+=`, and ${a[t].role} ${a[t].name} head to make the stop!`:0===t?e=`, but ${a[t].role} ${a[t].name}`:e+=`, ${a[t].role} ${a[t].name}`;fs.writeFileSync(`${r}/${t}.txt`,`${s+e}\n`,{flag:"a"},(e=>{if(e)throw e}));let o=[];for(let e=0;e<n.offense.length;e++)"block"==n.offense[e].objective&&a.includes(n.offense[e].target)&&o.push(n.offense[e]);if(1===o.length)l=`${o[0].role} ${o[0].name} comes to block!`;else if(2===o.length)l=`${o[0].role} ${o[0].name} and ${o[1].role} ${o[1].name} move to block!`;else for(let e=0;e<o.length;e++)e===o.length-1?l+=`, and ${o[e].role} ${o[e].name} try to form a wall for ${n.onsecond.previous.name}!`:0===e?l=`${o[e].role} ${o[e].name}`:l+=`, ${o[e].role} ${o[e].name}`;o.length>0&&fs.writeFileSync(`${r}/${t}.txt`,`${l}\n`,{flag:"a"},(e=>{if(e)throw e}))}if(null!==n.onfirst.current&&"stay on base"==n.onfirst.current.objective)0==n.onfirst.current.wasBallcarrier?fs.writeFileSync(`${r}/${t}.txt`,`First base runner ${n.onfirst.current.name} stays at first.\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,`Ballcarrier ${n.onfirst.current.name} stays on first.\n`,{flag:"a"},(e=>{if(e)throw e}));else if(null!==n.onfirst.previous&&"run to next base"==n.onfirst.previous.objective&&n.onfirst.previous!==n.ballcarrier){let e,l=`First base runner ${n.onfirst.previous.name} advances towards second`,s=[];for(let e=0;e<n.defense.length;e++)"tackle"==n.defense[e].objective&&n.defense[e].target==n.onfirst.previous&&s.push(n.defense[e]);if(s.length<1)e=" and the basepath is clear!";else if(1===s.length)e=`, but ${s[0].role} ${s[0].name} barrels towards him!`;else if(2===s.length)e=`, but ${s[0].role} ${s[0].name} and ${s[1].role} ${s[1].name} head straight for him!`;else for(let t=0;t<s.length;t++)t===s.length-1?e+=`, and ${s[t].role} ${s[t].name} head to make the stop!`:0===t?e=`, but ${s[t].role} ${s[t].name}`:e+=`, ${s[t].role} ${s[t].name}`;if(fs.writeFileSync(`${r}/${t}.txt`,`${l+e}\n`,{flag:"a"},(e=>{if(e)throw e})),i.length>0&&s.length>0){let e,l=[];for(let e=0;e<n.offense.length;e++)"block"==n.offense[e].objective&&s.includes(n.offense[e].target)&&l.push(n.offense[e]);if(1===l.length)e=`${l[0].role} ${l[0].name} comes to block!`;else if(2===l.length)e=`${l[0].role} ${l[0].name} and ${l[1].role} ${l[1].name} move to block!`;else for(let t=0;t<l.length;t++)t===l.length-1?e+=`, and ${l[t].role} ${l[t].name} try to form a wall for ${n.onfirst.previous.name}!`:0===t?e=`${l[t].role} ${l[t].name}`:e+=`, ${l[t].role} ${l[t].name}`;l.length>0&&fs.writeFileSync(`${r}/${t}.txt`,`${e}\n`,{flag:"a"},(e=>{if(e)throw e}))}}s.length>0&&l.length<1?fs.writeFileSync(`${r}/${t}.txt`,`${s[0].role} ${s[0].name} goes for the ball.\n`,{flag:"a"},(e=>{if(e)throw e})):s.length>0&&l.length>0?fs.writeFileSync(`${r}/${t}.txt`,`${s[0].role} ${s[0].name} goes for the ball, but so does ${l[0].role} ${l[0].name}!\n`,{flag:"a"},(e=>{if(e)throw e})):l.length>0&&fs.writeFileSync(`${r}/${t}.txt`,`${l[0].role} ${l[0].name} goes for the ball.\n`,{flag:"a"},(e=>{if(e)throw e}))}function doObjectives(e,t,r,n=null){let l=n,s=e,a=new NewResult(e);if(1===s.phase){let n=[],l=[];for(let e=0;e<s.offense.length;e++)"pursue the ball"==s.offense[e].objective&&(n.push(s.offense[e]),a.offense[e].position=a.offense[e].path[a.offense[e].path.length-1]);for(let e=0;e<s.defense.length;e++)"pursue the ball"==s.defense[e].objective&&(l.push(s.defense[e]),a.defense[e].position=a.defense[e].path[a.defense[e].path.length-1]);if(n.length<1&&l.length>0){fs.writeFileSync(`${r}/${t}.txt`,`${l[0].role} ${l[0].name} fields the ball! That's the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.phase=2,a.outs+=1,a.ballpath=null,a.catcherrot=!0,a.catchercount+=1,1==s.batter.hitter&&(s.batter.hitstoout++,s.batter.hitter=!1);for(let e of a.offense)1==e.assistor&&(e.turnovers++,e.assistor=!1);if(l[0].ballsfieldeddef++,l[0].totaloutsrecorded++,l[0].objective=null,l[0].path=null,a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a}else if(n.length>0&&l.length>0)if(awareCompare(n[0],l[0])==n[0].name){fs.writeFileSync(`${r}/${t}.txt`,`${n[0].role} ${n[0].name} beats ${l[0].name} to the ball, and a possession play begins!\n`,{flag:"a"},(e=>{if(e)throw e})),a.phase=4,a.ballpath=null,a.ballcarrier=n[0],a.ballcarrier.isRunner=!0,a.ballcarrier.position=a.ballcarrier.path[a.ballcarrier.path.length-1],l[0].position=l[0].path[l[0].path.length-1],l[0].objective=null,l[0].path=null,n[0].objective=null,n[0].path=null,n[0].ballsfieldedoff++,1==s.batter.hitter&&(s.batter.hitstooffense++,s.batter.hitter=!1);for(let e of s.offense)1==e.assistor&&(e.assistor=!1)}else{fs.writeFileSync(`${r}/${t}.txt`,`${l[0].role} ${l[0].name} is able to gain possession of the ball, and record the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.phase=2,a.outs++,a.ballpath=null,a.catcherrot=!0,a.catchercount++,n[0].position=n[0].path[n[0].path.length-1],l[0].position=l[0].path[l[0].path.length-1],l[0].objective=null,l[0].path=null,l[0].ballsfieldeddef++,l[0].totaloutsrecorded++,n[0].objective=null,n[0].path=null;for(let e of a.offense)1==e.assistor&&(e.turnovers++,e.assistor=!1);if(1==s.batter.hitter&&(s.batter.hitstoout++,s.batter.hitter=!1),a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a}else if(n.length>0&&l.length<1){fs.writeFileSync(`${r}/${t}.txt`,`${n[0].role} ${n[0].name} fields the ball, and a possession play begins!\n`,{flag:"a"},(e=>{if(e)throw e})),a.phase=4,a.ballpath=null,n[0].ballsfieldedoff++,1==s.batter.hitter&&(s.batter.hitstooffense++,s.batter.hitter=!1),a.ballcarrier=n[0],a.ballcarrier.isRunner=!0,a.ballcarrier==a.pitcher&&a.pitcherrot;for(let e of s.offense)1==e.assistor&&(e.assistor=!1)}}else if(s.phase<4){if(null!=s.ballcarrier&&"stay on base"!=s.ballcarrier.objective||null!=s.onfirst.current&&"stay on base"!=s.onfirst.current.objective||null!=s.onsecond.current&&"stay on base"!=s.onsecond.current.objective||null!=s.onthird.current&&"stay on base"!=s.onthird.current.objective||(a.phase=0,s.phase=0),null!==s.ballcarrier&&"run to next base"==s.ballcarrier.objective){let n=[],o=[];for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.ballcarrier&&o.push(s.defense[e]);for(let e=0;e<s.offense.length;e++)"block"==s.offense[e].objective&&o.includes(s.offense[e].target)&&n.push(s.offense[e]);for(let e=0;e<n.length;e++)null!==n[e].target.objective&&(1==blockCheck(n[e],n[e].target)?(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} blocks out ${n[e].target.name}!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].target.objective=null,n[e].target.path=null,n[e].target.position=n[e].path[n[e].path.length-1],n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].blocks++,n[e].path=null,n[e].target=null):(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} tries to block ${n[e].target.name}, but the defender breaks through!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target.position=n[e].path[n[e].path.length-1],n[e].target.blocksshed++,n[e].path=null,n[e].target=null));o=[];let i=0;for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.ballcarrier&&o.push(s.defense[e]);for(let n=0;n<o.length;n++){if(1==tackleCheck(s.ballcarrier,o[n])){fs.writeFileSync(`${r}/${t}.txt`,`${o[n].name} takes down the ballcarrier before he reaches ${s.ballcarrier.target}! OUT! That'll be the ${nthReturn(s.outs+1)}.\n`,{flag:"a"},(e=>{if(e)throw e})),"second"==a.ballcarrier.target?a.onfirst.previous=null:"third"==a.ballcarrier.target?a.onsecond.previous=null:"home"==a.ballcarrier.target&&(a.onthird.previous=null),a.ballcarrier.position=o[n].path[o[n].path.length-1],a.outs+=1,o[n].position=o[n].path[o[n].path.length-1],"Catcher"==a.ballcarrier.role&&(a.catcherrot=!0,a.catchercount++,a.ballcarrier.hasCaught=!0),a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.role=" ",a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier.onBase=null;for(let e=0;e<o.length;e++)o[e].target.name==a.ballcarrier.name&&(o[e].objective=null,o[e].target=null,o[e].path=null);if(a.ballcarrier=null,a.phase=2,o[n].tackles++,o[n].totaloutsrecorded++,a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}fs.writeFileSync(`${r}/${t}.txt`,`${s.ballcarrier.name} breaks through ${o[n].name}'s tackle!\n`,{flag:"a"},(e=>{if(e)throw e})),o[n].position=o[n].path[o[n].path.length-1],o[n].objective=null,o[n].path=null,a.ballcarrier.brokentackles++,i++}if(o.length<1||i===o.length)if(fs.writeFileSync(`${r}/${t}.txt`,`${s.ballcarrier.name} makes it to ${s.ballcarrier.target} safely!\n`,{flag:"a"},(e=>{if(e)throw e})),"first"==s.ballcarrier.target)a.onfirst.current=s.ballcarrier,a.ballcarrier.position=first,a.ballcarrier.onBase="first",a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.isReceiver=!1,a.phase=2,"Catcher"==s.ballcarrier.role&&(a.catcherrot=!0,a.ballcarrier.hasCaught=!0,a.catchercount++),a.ballcarrier.role="Runner";else if("second"==s.ballcarrier.target){a.onsecond.current=s.ballcarrier,a.ballcarrier.position=second,a.ballcarrier.onBase="second",a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.isReceiver=!1,a.ballcarrier.pointsScored++;for(let e of a.offense)1==e.assistor&&(e.assists++,e.assistpoints+=1,e.assistor=!1);if(a.score+=1,a.phase=2,fs.writeFileSync(`${r}/${t}.txt`,"One point scored!\n",{flag:"a"},(e=>{if(e)throw e})),a.onfirst.previous==a.ballcarrier&&(a.onfirst.previous=null),null!==l&&a.score+l[0]>l[1])return fs.writeFileSync(`${r}/${t}.txt`,"That score will end the game!\n",{flag:"a"},(e=>{if(e)throw e})),a.outs+=6,a;a.ballcarrier.role="Runner"}else if("third"==s.ballcarrier.target){a.onthird.current=a.ballcarrier,a.ballcarrier.position=third,a.ballcarrier.onBase="third",a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.isReceiver=!1,a.ballcarrier.pointsScored+=2;for(let e of a.offense)1==e.assistor&&(e.assists++,e.assistpoints+=2,e.assistor=!1);if(a.score+=2,a.phase=2,fs.writeFileSync(`${r}/${t}.txt`,"Two points scored!\n",{flag:"a"},(e=>{if(e)throw e})),a.onsecond.previous==a.ballcarrier&&(a.onsecond.previous=null),null!==l&&a.score+l[0]>l[1])return fs.writeFileSync(`${r}/${t}.txt`,"That score will end the game!\n",{flag:"a"},(e=>{if(e)throw e})),a.outs=a.outs+6,a;a.ballcarrier.role="Runner"}else if("home"==s.ballcarrier.target){a.ballcarrier.role=" ",a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier.onBase=null,a.ballcarrier.isReceiver=!1,a.ballcarrier.pointsScored+=5;for(let e of a.offense)1==e.assistor&&(e.assists++,e.assistpoints+=5,e.assistor=!1);if(a.score+=5,a.phase=2,fs.writeFileSync(`${r}/${t}.txt`,"Five points scored!\n",{flag:"a"},(e=>{if(e)throw e})),a.onthird.previous==a.ballcarrier&&(a.onthird.previous=null),null!==l&&a.score+l[0]>l[1])return fs.writeFileSync(`${r}/${t}.txt`,"That score will end the game!\n",{flag:"a"},(e=>{if(e)throw e})),a.outs=a.outs+6,a;a.ballcarrier=null}}if(null!==s.onthird.previous&&s.onthird.previous!==s.ballcarrier&&"run to next base"==s.onthird.previous.objective){let n=[],o=[];for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onthird.previous&&o.push(s.defense[e]);for(let e=0;e<s.offense.length;e++)"block"==s.offense[e].objective&&o.includes(s.offense[e].target)&&n.push(s.offense[e]);for(let e=0;e<n.length;e++)null!=n[e].target.objective&&(1==blockCheck(n[e],n[e].target)?(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} blocks out ${n[e].target.name}!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].target.objective=null,n[e].target.path=null,n[e].target.position=n[e].path[n[e].path.length-1],n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target=null,n[e].blocks++):(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} tries to block ${n[e].target.name}, but the defender breaks through!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target.blocksshed++,n[e].target=null));o=[];let i=0;for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onthird.previous&&o.push(s.defense[e]);for(let n=0;n<o.length;n++){if(1==tackleCheck(s.onthird.previous,o[n])){if(fs.writeFileSync(`${r}/${t}.txt`,`${o[n].name} takes down the third base runner before he reaches home, for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.onthird.previous.position=o[n].path[o[n].path.length-1],o[n].position=o[n].path[o[n].path.length-1],a.onthird.previous.objective=null,a.onthird.previous.target=null,a.onthird.previous.role=" ",a.onthird.previous.path=null,a.onthird.previous.isRunner=!1,a.onthird.previous.onBase=null,a.onthird.previous==a.onthird.current&&(a.onthird.current=null),a.onthird.previous=null,a.outs+=1,o[n].tackles++,o[n].totaloutsrecorded++,a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}fs.writeFileSync(`${r}/${t}.txt`,`${s.onthird.previous.name} breaks through ${o[n].name}'s tackle!\n`,{flag:"a"},(e=>{if(e)throw e})),o[n].position=o[n].path[o[n].path.length-1],s.onthird.previous.brokentackles++,i++}if((o.length<1||i===o.length)&&(fs.writeFileSync(`${r}/${t}.txt`,`${s.onthird.previous.name} makes it home safely!\n`,{flag:"a"},(e=>{if(e)throw e})),a.onthird.previous.role=" ",a.onthird.previous.path=null,a.onthird.previous.isRunner=!1,a.onthird.previous.onBase=null,a.onthird.previous.pointsScored+=3,a.onthird.current==a.onthird.previous&&(a.onthird.current=null),a.onthird.previous=null,a.score+=3,fs.writeFileSync(`${r}/${t}.txt`,"Three points scored!\n",{flag:"a"},(e=>{if(e)throw e})),null!==l&&a.score+l[0]>l[1]))return fs.writeFileSync(`${r}/${t}.txt`,"That score will end the game!\n",{flag:"a"},(e=>{if(e)throw e})),a.outs+=6,a}if(null!==s.onsecond.previous&&s.onsecond.previous!==s.ballcarrier&&"run to next base"==s.onsecond.previous.objective){let n=[],l=[];for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onsecond.previous&&l.push(s.defense[e]);for(let e=0;e<s.offense.length;e++)"block"==s.offense[e].objective&&l.includes(s.offense[e].target)&&n.push(s.offense[e]);for(let e=0;e<n.length;e++)null!==n[e].target.objective&&(1==blockCheck(n[e],n[e].target)?(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} blocks out ${n[e].target.name}!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].target.objective=null,n[e].target.path=null,n[e].target.position=n[e].path[n[e].path.length-1],n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target=null,n[e].blocks++):(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} tries to block ${n[e].target.name}, but the defender breaks through!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target.blocksshed++,n[e].target=null));l=[];let o=0;for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onsecond.previous&&l.push(s.defense[e]);for(let n=0;n<l.length;n++){if(1==tackleCheck(s.onsecond.previous,l[n])){if(fs.writeFileSync(`${r}/${t}.txt`,`${l[n].name} takes down the second base runner before he reaches third! That's the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.onsecond.previous.position=l[n].path[l[n].path.length-1],l[n].position=l[n].path[l[n].path.length-1],a.onsecond.previous.objective=null,a.onsecond.previous.target=null,a.onsecond.previous.role=" ",a.onsecond.previous.path=null,a.onsecond.previous.isRunner=!1,a.onsecond.previous.onBase=null,a.onsecond.previous==a.onsecond.current&&(a.onsecond.current=null),a.onsecond.previous=null,a.outs+=1,l[n].tackles++,l[n].totaloutsrecorded++,a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}fs.writeFileSync(`${r}/${t}.txt`,`${s.onsecond.previous.name} breaks through ${l[n].name}'s tackle!\n`,{flag:"a"},(e=>{if(e)throw e})),l[n].position=l[n].path[l[n].path.length-1],o++,s.onsecond.previous.brokentackles++}(l.length<1||o===l.length)&&(fs.writeFileSync(`${r}/${t}.txt`,`${a.onsecond.previous.name} makes it to third safely!`,{flag:"a"},(e=>{if(e)throw e})),a.onthird.current=s.onsecond.previous,a.onthird.current.onBase="third",a.onthird.current.position=third,a.onsecond.current==a.onthird.current&&(a.onsecond.current=null),a.onsecond.previous=null)}if(null!==s.onfirst.previous&&(null==s.ballcarrier||s.onfirst.previous!==s.ballcarrier)&&"run to next base"==s.onfirst.previous.objective){let n=[],l=[];for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onfirst.previous&&l.push(s.defense[e]);for(let e=0;e<s.offense.length;e++)"block"==s.offense[e].objective&&l.includes(s.offense[e].target)&&n.push(s.offense[e]);for(let e=0;e<n.length;e++)null!==n[e].target.objective&&(1==blockCheck(n[e],n[e].target)?(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} blocks out ${n[e].target.name}!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].target.objective=null,n[e].target.path=null,n[e].target.position=n[e].path[n[e].path.length-1],n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target=null,n[e].blocks++):(fs.writeFileSync(`${r}/${t}.txt`,`${n[e].name} tries to block ${n[e].target.name}, but the defender breaks through!\n`,{flag:"a"},(e=>{if(e)throw e})),n[e].objective=null,n[e].position=n[e].path[n[e].path.length-1],n[e].target.blocksshed++,n[e].target=null));l=[];let o=0;for(let e=0;e<s.defense.length;e++)"tackle"==s.defense[e].objective&&s.defense[e].target==s.onfirst.previous&&l.push(s.defense[e]);for(let n=0;n<l.length;n++){if(1==tackleCheck(s.onfirst.previous,l[n])){if(fs.writeFileSync(`${r}/${t}.txt`,`${l[n].name} takes down the first base runner before he reaches second, for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.onfirst.previous.position=l[n].path[l[n].path.length-1],l[n].position=l[n].path[l[n].path.length-1],a.onfirst.previous.objective=null,a.onfirst.previous.target=null,a.onfirst.previous.role=" ",a.onfirst.previous.path=null,a.onfirst.previous.isRunner=!1,a.onfirst.previous.onBase=null,a.onfirst.previous=null,a.outs+=1,l[n].tackles++,l[n].totaloutsrecorded++,a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}fs.writeFileSync(`${r}/${t}.txt`,`${s.onfirst.previous.name} breaks through ${l[n].name}'s tackle!\n`,{flag:"a"},(e=>{if(e)throw e})),l[n].position=l[n].path[l[n].path.length-1],o++}(l.length<1||o===l.length)&&(fs.writeFileSync(`${r}/${t}.txt`,`${s.onfirst.previous.name} makes it to second safely!`,{flag:"a"},(e=>{if(e)throw e})),a.onsecond.current=s.onfirst.previous,a.onfirst.previous=null,a.onsecond.current.onBase="second",a.onsecond.current.position=second,a.onsecond.current.objective=null,a.onsecond.current.path=null)}}else if(4===s.phase){let n=s.ballcarrier.path,l=s.ballcarrier.target;s.ballcarrier.onBase=null,s.ballcarrier.isRunner=!1;let o=flightPath(s.ballcarrier.position,fieldingVector(s.ballcarrier,s.ballcarrier.position,s.ballcarrier.target.position)),i=areaReturn(o[o.length-1]),h=[],f=[],c=[];for(let e=0;e<s.defense.length;e++){let t={player:s.defense[e],path:singleInterceptPath(s.defense[e],s.defense[e].position,n)};c.push(t)}for(let e=0;e<c.length;e++)c[e].path.length<n.length?h.push(c[e]):c[e].path.length===n.length&&f.push(c[e]);if(h.length<=0&&f.length<=0)if(awareCheck(l)){fs.writeFileSync(`${r}/${t}.txt`,`${l.name} catches the ball!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier=l,a.ballcarrier.isReceiver=!0,a.phase=3}else{fs.writeFileSync(`${r}/${t}.txt`,`${l.name} can't make the catch and the ball sails ${i}!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballpath=o,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier=null,a.phase=1}else if(h.length>0&&f.length>0){fs.writeFileSync(`${r}/${t}.txt`,"He's absolutely smothered by the defense!\n",{flag:"a"},(e=>{if(e)throw e}));let n=0;for(let l=0;l<h.length;l++){if(awareCheck(h[l].player)){if(fs.writeFileSync(`${r}/${t}.txt`,`${h[l].player.name} intercepts the pass for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.outs++,a.phase=2,"Catcher"==a.ballcarrier.role&&(a.catcherrot=!0,a.ballcarrier.hasCaught=!0),a.ballcarrier.turnovers++,h[l].player.interceptions++,h[l].player.totaloutsrecorded++,a.ballcarrier.objective=null,a.ballcarrier.path=null,a.ballcarrier.target=null,a.ballcarrier=null,n++,h[l].player.position=h[l].path[h[l].path.length-1],a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}h[l].player.position=h[l].path[h[l].path.length-1]}if(n<1)for(let o=0;o<f.length;o++){if(awareCompare(f[o].player,l)==f[o].player.name){if(fs.writeFileSync(`${r}/${t}.txt`,`${f[o].player.name} intercepts the pass for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.outs++,a.phase=2,"Catcher"==a.ballcarrier.role&&(a.catcherrot=!0,a.ballcarrier.hasCaught=!0),a.ballcarrier.turnovers++,f[o].player.interceptions++,f[o].player.totaloutsrecorded++,a.ballcarrier.objective=null,a.ballcarrier.path=null,a.ballcarrier.target=null,a.ballcarrier=null,n++,f[o].player.position=f[o].path[f[o].path.length-1],a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}f[o].player.position=f[o].path[f[o].path.length-1]}if(0===n)if(awareCheck(l)){fs.writeFileSync(`${r}/${t}.txt`,`${l.name} makes the catch!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier=l,a.ballcarrier.isReceiver=!0,a.phase=3}else{fs.writeFileSync(`${r}/${t}.txt`,`${l.name} can't make the catch either and the ball sails ${i}!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballpath=o,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier=null,a.phase=1}}else if(h.length>0){1===h.length?fs.writeFileSync(`${r}/${t}.txt`,`${h[0].player.name} has a chance at the pick!\n`,{flag:"a"},(e=>{if(e)throw e})):2===h.length?fs.writeFileSync(`${r}/${t}.txt`,"Two defenders have a chance at the pick!\n",{flag:"a"},(e=>{if(e)throw e})):3===h.length?fs.writeFileSync(`${r}/${t}.txt`,"Half the defense have a chance to intercept this one!\n",{flag:"a"},(e=>{if(e)throw e})):4===h.length?fs.writeFileSync(`${r}/${t}.txt`,"A bad decision to throw it into such intense coverage.\n",{flag:"a"},(e=>{if(e)throw e})):5===h.length?fs.writeFileSync(`${r}/${t}.txt`,"This ball should never have been thrown!\n",{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,`A ticket to the bench for ${s.ballcarrier.name}! What an awful throw!\n`,{flag:"a"},(e=>{if(e)throw e}));let n=0;for(let l=0;l<h.length;l++){if(awareCheck(h[l].player)){if(fs.writeFileSync(`${r}/${t}.txt`,`${h[l].player.name} intercepts the pass for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.outs++,a.phase=2,"Catcher"==a.ballcarrier.role&&(a.catcherrot=!0,a.ballcarrier.hasCaught=!0),a.ballcarrier.turnovers++,h[l].player.interceptions++,h[l].player.totaloutsrecorded++,a.ballcarrier.objective=null,a.ballcarrier.path=null,a.ballcarrier.target=null,a.ballcarrier=null,n++,h[l].player.position=h[l].path[h[l].path.length-1],a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}h[l].player.position=h[l].path[h[l].path.length-1]}if(0===n)if(1===h.length?fs.writeFileSync(`${r}/${t}.txt`,`${h[0].player.name} can't come up with it!\n`,{flag:"a"},(e=>{if(e)throw e})):2===h.length?fs.writeFileSync(`${r}/${t}.txt`,"Neither defender can come up with the pick!\n",{flag:"a"},(e=>{if(e)throw e})):3===h.length?fs.writeFileSync(`${r}/${t}.txt`,"Three chances for the defense, no dice!\n",{flag:"a"},(e=>{if(e)throw e})):4===h.length?fs.writeFileSync(`${r}/${t}.txt`,"The ball sails through four defenders hands'!\n",{flag:"a"},(e=>{if(e)throw e})):5===h.length?fs.writeFileSync(`${r}/${t}.txt`,"Incredible! The ball bypasses five defenders!\n",{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,"Pitiful display! All six defenders had a shot at a pick, but none of them came up with it!\n",{flag:"a"},(e=>{if(e)throw e})),awareCheck(l)){fs.writeFileSync(`${r}/${t}.txt`,`${l.name} makes the catch!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier=l,a.ballcarrier.isReceiver=!0,a.phase=3}else{fs.writeFileSync(`${r}/${t}.txt`,`${l.name} can't make the catch either and the ball sails ${i}!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballpath=o,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier=null,a.phase=1}}else if(f.length>0){1===f.length?fs.writeFileSync(`${r}/${t}.txt`,`${f[0].player.name} tries to defend the pass!\n`,{flag:"a"},(e=>{if(e)throw e})):2===f.length?fs.writeFileSync(`${r}/${t}.txt`,`${f[0].player.name} and ${f[1].player.name} double cover the receiver!\n`,{flag:"a"},(e=>{if(e)throw e})):fs.writeFileSync(`${r}/${t}.txt`,"The defense closes in to defend the pass!\n",{flag:"a"},(e=>{if(e)throw e}));let n=0;for(let o=0;o<f.length;o++){if(awareCompare(f[o].player,l)==f[o].player.name){if(fs.writeFileSync(`${r}/${t}.txt`,`${f[o].player.name} intercepts the pass for the ${nthReturn(s.outs+1)} OUT!\n`,{flag:"a"},(e=>{if(e)throw e})),a.outs++,a.phase=2,"Catcher"==a.ballcarrier.role&&(a.catcherrot=!0,a.ballcarrier.hasCaught=!0),a.ballcarrier.turnovers++,f[o].player.interceptions++,f[o].player.totaloutsrecorded++,a.ballcarrier.objective=null,a.ballcarrier.path=null,a.ballcarrier.target=null,a.ballcarrier=null,n++,f[o].player.position=f[o].path[f[o].path.length-1],a.outs+e.outs>=6)return fs.writeFileSync(`${r}/${t}.txt`,"That's the sixth out, and so retires the side! Our score:\n\n",{flag:"a"},(e=>{if(e)throw e})),a;break}f[o].player.position=f[o].path[f[o].path.length-1]}if(0===n)if(1===f.length?fs.writeFileSync(`${r}/${t}.txt`,`${f[0].player.name} can't come up with the pick!\n`,{flag:"a"},(e=>{if(e)throw e})):2===f.length?fs.writeFileSync(`${r}/${t}.txt`,"Neither defender can come up with the pick!\n",{flag:"a"},(e=>{if(e)throw e})):3===f.length&&fs.writeFileSync(`${r}/${t}.txt`,"The defense can't get there in time!\n",{flag:"a"},(e=>{if(e)throw e})),awareCheck(l)){fs.writeFileSync(`${r}/${t}.txt`,`${l.name} makes the catch!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier.isRunner=!1,a.ballcarrier=l,a.ballcarrier.isReceiver=!0,a.phase=3}else{fs.writeFileSync(`${r}/${t}.txt`,`${l.name} can't make the catch either and the ball sails ${i}!\n`,{flag:"a"},(e=>{if(e)throw e}));for(let e of a.offense)1==e.assistor&&(e.assistor=!1);a.ballcarrier.assistor=!0,a.ballpath=o,a.ballcarrier.objective=null,a.ballcarrier.target=null,a.ballcarrier.path=null,a.ballcarrier=null,a.phase=1}}}return a}function blockCheck(e,t){return randInt(0,100-(e.attributes.block-t.attributes.breakblock))<50}function tackleCheck(e,t){return randInt(0,100-(t.attributes.tackle-e.attributes.breaktackle))<50}function singleInterceptPath(e,t,r){let n,l=[],s=[],a=[],o=r;for(let r=0;r<o.length;r++)o[r].z<=20&&l.push(runPath(e,t,o[r],[]));for(let e=0;e<l.length;e++){if(!(l[e].length>0))continue;n=l[e][l[e].length-1];for(let e=0;e<r.length;e++)r[e].x===n.x&&r[e].y===n.y&&(n=r[e]);let t=Number(r.indexOf(n))+1;l[e].length<=t&&a.push(l[e])}if(a.length>0){s.push(a[0]);for(let e=0;e<a.length;e++)a[e].length<=s[0].length&&(s=a[e])}return s.length<1&&(s=runPath(e,t,o[o.length-1],[])),s}function runPath(e,t,r,n){let l=0;l=1==awareCheck(e)?6.7:randInt(10,15);let s=playerRoute(e,t,r,l),a=r,o=t,i={x:t.x-r.x,y:t.y-r.y,z:t.z-r.z},h=n;try{return a.x===o.x&&(s.x=a.x),a.y===o.y&&(s.y=a.y),(a.x>o.x&&a.x<s.x||a.x<o.x&&a.x>s.x)&&(s.x=a.x),(a.y>o.y&&a.y<s.y||a.y<o.y&&a.y>s.y)&&(s.y=a.y),0===i.x&&0===i.y?(n.length<1&&n.push(a),n):(h.push(s),runPath(e,s,a,h,i))}catch(e){return a}return n}function playerRoute(e,t,r,n){let l=fieldingVector(e,t,r),s={x:0,y:0,z:15},a=Math.round(e.attributes.speed/n);return 0===l[0].x?s.x=t.x:l[0].x>0?s.x=Math.round(t.x+a):s.x=Math.round(t.x-a),0===l[0].y?s.y=t.y:l[0].y>0?s.y=Math.round(t.y+a):s.y=Math.round(t.y-a),s}function fieldingVector(e,t,r){let n=[{x:0,y:0,z:0},e.attributes.speed],l=Math.abs(t.x)+Math.abs(r.x),s=Math.abs(t.y)+Math.abs(r.y);return n[0].x=l/(l+s),n[0].y=s/(l+s),t.x>r.x&&(n[0].x=-1*n[0].x),t.y>r.y&&(n[0].y=-1*n[0].y),n}class Pitch{constructor(e,t){this.pitchspeed=pitchSpeed(e),this.accuracy=accuracy(e),this.swingdecide=swingDecide(this.accuracy,t),this.hit=hit(this.swingdecide,this.pitchspeed,t,this.accuracy),this.ball=ball(this.swingdecide,this.accuracy),this.strike=strike(this.swingdecide,this.hit,this.accuracy)}}function accuracy(e){return randInt(0,130)<e.attributes.eye}function swingDecide(e,t){return 1==e?randInt(0,110)<t.attributes.eye:!(randInt(0,115)<t.attributes.eye)}function hit(e,t,r,n){let l=t+r.attributes.eye;return 1==e?1==n?randInt(0,l)<r.attributes.eye:randInt(0,2*l)<r.attributes.eye:null}function ball(e,t){return 0==e&&0==t}function strike(e,t,r){return 1==e&&0==t||0==e&&1==r}function pitchSpeed(e){return randInt(e.attributes.power-2,e.attributes.power+2)}function randInt(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function flightPath(e,t,r=[]){let n=t;if(n[0].z>0||n[1]>=1){let n=ballRoute(e,t);r.includes(n[0])||r.push(n[0]),flightPath(n[0],n[1],r)}return r[r.length-1].z>15&&(r[r.length-1].z=15),r}function ballRoute(e,t){let r={x:0,y:0,z:0},n=[{x:0,y:0,z:0},0];return t[0].z<=0?t[0].x>=0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/2),n[0].z=0,r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),e.z<=0?r.z=0:(e.z,Math.floor(e.z/(200/t[1])),r.z<=0&&(r.z=0))):t[0].x<0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/2),n[0].z=0,r.x=Math.floor(e.x-Math.abs(t[0].x*Math.floor(t[1]))),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),e.z<=0?r.z=0:(e.z,Math.floor(e.z/(200/t[1])),r.z<=0&&(r.z=0))):t[0].x>=0&&t[0].y<0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/2),n[0].z=0,r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),e.z<=0?r.z=0:(e.z,Math.floor(e.z/(200/t[1])),r.z<=0&&(r.z=0))):t[0].x<0&&t[0].y<0&&(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/2),n[0].z=0,r.x=Math.floor(e.x-Math.abs(t[0].x*Math.floor(t[1]))),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),e.z<=0?r.z=0:(e.z,Math.floor(e.z/(200/t[1])),r.z<=0&&(r.z=0))):t[0].z<=2?t[0].x>=0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1,r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),r.z=Math.floor(e.z-e.z/(t[1]/n[1])*.5)):t[0].x<0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1/(t[1]-n[1]),r.x=Math.floor(e.x-Math.abs(t[0].y*Math.floor(t[1]))),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),r.z=Math.floor(e.z-e.z/(t[1]/n[1])*.5)):t[0].x>=0&&t[0].y<0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/2),n[0].z=t[0].z-1/(t[1]-n[1]),r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),r.z=Math.floor(e.z-e.z/(t[1]/n[1])*.5)):t[0].x<0&&t[0].y<0&&(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1/(t[1]-n[1]),r.x=Math.floor(e.x-Math.abs(t[0].x*Math.floor(t[1]))),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),r.z=Math.floor(e.z-e.z/(t[1]/n[1])*.5)):t[0].z>2&&(t[0].x>=0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2)-1,n[0].z=t[0].z-1,r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),r.z=Math.floor(e.z+Math.floor(t[1]/2))):t[0].x<0&&t[0].y>=0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1,r.x=Math.floor(e.x-Math.abs(t[0].x*Math.floor(t[1]))),r.y=Math.floor(e.y+t[0].y*Math.floor(t[1])),r.z=Math.floor(e.z+Math.floor(t[1]/2))):t[0].x>=0&&t[0].y<0?(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1,r.x=Math.floor(e.x+t[0].x*Math.floor(t[1])),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),r.z=Math.floor(e.z+Math.floor(t[1]/2))):t[0].x<0&&t[0].y<0&&(n[0].x=t[0].x,n[0].y=t[0].y,n[1]=Math.floor(t[1]/1.2),n[0].z=t[0].z-1,r.x=Math.floor(e.x-Math.abs(t[0].x*Math.floor(t[1]))),r.y=Math.floor(e.y-Math.abs(t[0].y*Math.floor(t[1]))),r.z=Math.floor(e.z+Math.floor(t[1]/2)))),[r,n]}function vectorMaker(e,t=null){let r=e.attributes.power,n=0;n=1==awareCheck(e)?20:randInt(1,10);let l=[{x:0,y:0,z:0},r*(randInt(1,n)/10)];return l[0].x=randInt(-6,10)/10,0!==l[0].x?l[0].x>0?Math.random()>=.5?l[0].y=1-l[0].x:l[0].y=-1+l[0].x:Math.random()>=.5?l[0].y=1+l[0].x:l[0].y=-1-l[0].x:l[0].y=1,l[0].z=null==t?randInt(0,5):t,l}function awareCompare(e,t){return randInt(0,e.attributes.awareness+t.attributes.awareness)<=e.attributes.awareness?e.name:t.name}function awareCheck(e){return randInt(0,115)<=e.attributes.awareness}function throwOrRun(e){let t=e,r=t.ballcarrier,n={throw:!1,target:null,path:null},l=[];for(let e=0;e<t.offense.length;e++)t.offense[e]!==r&&null!==t.offense[e].onBase&&l.push(t.offense[e]);if(l.length>0){if(l.length>1){let e,t=[],r=[];for(let e of l)"first"==e.onBase?t.push(3):"second"==e.onBase?t.push(2):"third"==e.onBase&&t.push(1);for(let n=0;n<l.length;n++){e=1e3;for(let r=0;r<t.length;r++)e>t[r]&&(e=t[r]);let n=t.indexOf(e);r.push(l[n]),t[n]=1e3}l=r}for(let e=0;e<l.length;e++){let s=throwPath(r,r.position,l[e].position,[]),a=[];for(let e=0;e<t.defense.length;e++){let r={player:t.defense[e],path:singleInterceptPath(t.defense[e],t.defense[e].position,s)};a.push(r)}let o=[],i=[];for(let e=0;e<a.length;e++)a[e].path.length<s.length?o.push(a[e]):a[e].path.length===s.length&&i.push(a[e]);if(o.length>0){if(awareCheck(r))continue;if(randInt(0,100)>=50)continue;n.throw=!0,n.target=l[e],n.path=s}else if(i.length>0)if(awareCheck(r)){let t=l[e].attributes.awareness,r=[];for(let e=0;e<i.length;e++)r.push(i[e].player.attributes.awareness);let a=0;for(let e=0;e<r.length;e++)r[e]>t&&a++;if(a>0)continue;n.throw=!0,n.target=l[e],n.path=s}else{if(!(randInt(0,100)>=50))continue;n.throw=!0,n.target=l[e],n.path=s}else if(awareCheck(r))n.throw=!0,n.target=l[e],n.path=s;else{if(!(randInt(0,100)>=50))continue;n.throw=!0,n.target=l[e],n.path=s}}}return n}function throwPath(e,t,r,n,l={x:t.x-r.x,y:t.y-r.y,z:t.z-r.z}){let s=throwBall(e,t,r),a=r;try{return a.x===t.x&&(s.x=a.x),a.y===t.y&&(s.y=a.y),(a.x>t.x&&a.x<s.x||a.x<t.x&&a.x>s.x)&&(s.x=a.x),(a.y>t.y&&a.y<s.y||a.y<t.y&&a.y>s.y)&&(s.y=a.y),0===l.x&&0===l.y?n.length<1?(n.push(a),n):n:(n.push(s),runPath(e,s,a,n),n)}catch(e){return a}}function throwBall(e,t,r){let n=fieldingVector(e,t,r),l={x:0,y:0,z:15},s=Math.round(e.attributes.power/1.2);return 0===n[0].x?l.x=t.x:n[0].x>0?l.x=Math.round(t.x+s):l.x=Math.round(t.x-s),0===n[0].y?l.y=t.y:n[0].y>0?l.y=Math.round(t.y+s):l.y=Math.round(t.y-s),l}function resultsTest(e,t,r){let n={[e.name]:{wins:0,losses:0,ties:0},[t.name]:{wins:0,losses:0,ties:0}};for(let l=0;l<r;l++){let r=fullGame(e,t);r.home>r.away?(n[e.name].wins++,n[t.name].losses++):r.home===r.away?(n[e.name].ties++,n[t.name].ties++):(n[e.name].losses++,n[t.name].wins++)}return n}function gameRunner(e,t,r,n){let l,s=`${n} ${t.name} @ ${e.name}`,a=e.roster.concat(t.roster),o=new GameStats(a),i=[];try{l=fullGame(e,t,s,r);let n=l[1].concat(l[2]);for(let e=0;e<n.length;e++)o[n[e].name].pointsScored=n[e].pointsScored,o[n[e].name].assists=n[e].assists,o[n[e].name].assistpoints=n[e].assistpoints,o[n[e].name].hitstoout=n[e].hitstoout,o[n[e].name].hitstooffense=n[e].hitstooffense,o[n[e].name].ballsfieldeddef=n[e].ballsfieldeddef,o[n[e].name].ballsfieldedoff=n[e].ballsfieldedoff,o[n[e].name].totaloutsrecorded=n[e].totaloutsrecorded,o[n[e].name].slams=n[e].slams,o[n[e].name].slamsgiven=n[e].slamsgiven,o[n[e].name].atbats=n[e].atbats,o[n[e].name].hits=n[e].hits,o[n[e].name].strikes=n[e].strikes,o[n[e].name].strikeoutspitching=n[e].strikeoutspitching,o[n[e].name].balls=n[e].balls,o[n[e].name].ballouts=n[e].ballouts,o[n[e].name].fouls=n[e].fouls,o[n[e].name].pitches=n[e].pitches,o[n[e].name].strikeoutsbatting=n[e].strikeoutsbatting,o[n[e].name].foulouts=n[e].foulouts,o[n[e].name].tackles=n[e].tackles,o[n[e].name].brokentackles=n[e].brokentackles,o[n[e].name].blocks=n[e].blocks,o[n[e].name].blocksshed=n[e].blocksshed,o[n[e].name].interceptions=n[e].interceptions,o[n[e].name].turnovers=n[e].turnovers;return i.push(l[0]),i.push(o),i}catch(l){return fs.unlinkSync(`${r}/${s}.txt`),gameRunner(e,t,r,n)}}export{gameRunner,randInt};