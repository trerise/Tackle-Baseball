import ansiRegex from"ansi-regex";import wcwidth from"wcwidth";import fs from"fs";function Table(){this.rows=[],this.row={__printers:{}}}function string(r){return void 0===r?"":""+r}function length(r){var t=r.replace(ansiRegex,"");return null==wcwidth?t.length:wcwidth(t)}function leftPadder(r){return function(t,n){var e=string(t),o=length(e);return(n>o?Array(n-o+1).join(r):"")+e}}Table.prototype.newRow=function(){return this.rows.push(this.row),this.row={__printers:{}},this},Table.prototype.cell=function(r,t,n){return this.row[r]=t,this.row.__printers[r]=n||string,this},Table.prototype.separator="  ",Table.string=string,Table.leftPadder=leftPadder;var padLeft=Table.padLeft=leftPadder(" ");function rightPadder(r){return function(t,n){var e=string(t),o=length(e);return e+(n>o?Array(n-o+1).join(r):"")}}Table.rightPadder=rightPadder;var padRight=rightPadder(" ");function each(r,t){for(var n in r)"__printers"!=n&&t(n,r[n])}function compare(r,t){return r===t?0:void 0===r?1:void 0===t?-1:null===r?1:null===t?-1:r>t?1:r<t?-1:compare(String(r),String(t))}Table.number=function(r){return function(t,n){if(null==t)return"";if("number"!=typeof t)throw new Error(t+" is not a number");var e=null==r?t+"":t.toFixed(r);return padLeft(e,n)}},Table.prototype.columns=function(){for(var r={},t=0;t<2;t++)this.rows.forEach((function(t){var n=0;each(t,(function(t){n=Math.max(n,r[t]||0),r[t]=n,n++}))}));return Object.keys(r).sort((function(t,n){return r[t]-r[n]}))},Table.prototype.print=function(){var r=this.columns(),t=this.separator,n={},e="";return this.rows.forEach((function(r){each(r,(function(t,e){var o=r.__printers[t].call(r,e);n[t]=Math.max(length(o),n[t]||0)}))})),this.rows.forEach((function(o){var i="";r.forEach((function(r){var e=n[r],a=o.hasOwnProperty(r)?""+o.__printers[r].call(o,o[r],e):"";i+=padRight(a,e)+t})),i=i.slice(0,-t.length),e+=i+"\n"})),e},Table.prototype.toString=function(){var r=this.columns(),t=new Table;return t.separator=this.separator,r.forEach((function(r){t.cell(r,r)})),t.newRow(),t.pushDelimeter(r),t.rows=t.rows.concat(this.rows),this.totals&&this.rows.length&&(t.pushDelimeter(r),this.forEachTotal(t.cell.bind(t)),t.newRow()),t.print()},Table.prototype.pushDelimeter=function(r){return(r=r||this.columns()).forEach((function(r){this.cell(r,void 0,leftPadder("-"))}),this),this.newRow()},Table.prototype.forEachTotal=function(r){for(var t in this.totals){var n=this.totals[t],e=n.init,o=this.rows.length;this.rows.forEach((function(r,i){e=n.reduce.call(r,e,r[t],i,o)})),r(t,e,n.printer)}},Table.prototype.printTransposed=function(r){r=r||{};var t=new Table;return t.separator=r.separator||this.separator,this.columns().forEach((function(n){t.cell(0,n,r.namePrinter),this.rows.forEach((function(r,e){t.cell(e+1,r[n],r.__printers[n])})),t.newRow()}),this),t.print()},Table.prototype.sort=function(r){if("function"==typeof r)return this.rows.sort(r),this;var t=(Array.isArray(r)?r:this.columns()).map((function(r){var t="asc",n=/(.*)\|\s*(asc|des)\s*$/.exec(r);return n&&(r=n[1],t=n[2]),function(n,e){return"asc"==t?compare(n[r],e[r]):compare(e[r],n[r])}}));return this.sort((function(r,n){for(var e=0;e<t.length;e++){var o=t[e](r,n);if(0!=o)return o}return 0}))},Table.prototype.total=function(r,t){return t=t||{},this.totals=this.totals||{},this.totals[r]={reduce:t.reduce||Table.aggr.sum,printer:t.printer||padLeft,init:null==t.init?0:t.init},this},Table.aggr={},Table.aggr.printer=function(r,t){return t=t||string,function(n,e){return padLeft(r+t(n),e)}},Table.aggr.sum=function(r,t){return r+t},Table.aggr.avg=function(r,t,n,e){return r+=t,n+1==e?r/e:r},Table.print=function(r,t,n){var e=t||{};t="function"==typeof t?t:function(r,t){for(var n in r)if(r.hasOwnProperty(n)){var o=e[n]||{};t(o.name||n,r[n],o.printer)}};var o=new Table,i=o.cell.bind(o);return Array.isArray(r)?(n=n||function(r){return r.toString()},r.forEach((function(r){t(r,i),o.newRow()}))):(n=n||function(r){return r.printTransposed({separator:" : "})},t(r,i),o.newRow()),n(o)};export{Table};Table.log=function(r,t,n){console.log(Table.print(r,t,n))},Table.prototype.log=function(){console.log(this.toString())};